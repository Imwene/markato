var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,l=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(r)for(var a of r(t))n.call(t,a)&&i(e,a,t[a]);return e},o=(e,r)=>t(e,a(r)),c=(e,t,a)=>new Promise(((r,s)=>{var n=e=>{try{l(a.next(e))}catch(t){s(t)}},i=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);l((a=a.apply(e,t)).next())}));import{j as d,r as m,s as h,t as x,u,v as p,w as b,x as g,y as v,z as j,C as y,E as N,H as f,I as k,P as w}from"../vendor/ui-vendor-B-ENX0mK.js";import{r as S}from"../vendor/react-vendor-D7383juu.js";import{a as T,C as E}from"../index-BASjt89t.js";import{u as D,a as A}from"./useConfig-Bs4z4don.js";import"../vendor/auth-vendor-sPk1YpsG.js";const F=()=>{const e=S.useContext(T);if(void 0===e)throw new Error("useServices must be used within a ServicesProvider");return e},C=({selectedService:e,selectedScent:t,onServiceSelect:a,onScentSelect:r,selectedVehicleType:s,onContinue:n,canProceedToDetails:i})=>{const[l,o]=S.useState(null),{services:c,loading:b,error:g}=F(),{scents:v,loading:j}=D();S.useEffect((()=>{o(null),a(null),r(null)}),[s]);const y=e=>{var t;return(null==(t=null==e?void 0:e.vehiclePricing)?void 0:t[s])||0};return b?d.jsx("div",{className:"flex justify-center items-center py-8",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light"})}):g?d.jsx("div",{className:"text-center py-8 text-red-600",children:g}):d.jsxs("div",{className:"space-y-4",children:[c.map((s=>{var n;const i=s._id||s.id;return d.jsxs(m.div,{className:`\n              bg-background-light rounded-lg overflow-hidden \n              ${e===i?"border-2 border-primary-light shadow-lg shadow-primary-light/10":"border border-border-DEFAULT hover:border-border-dark"}\n            `,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[d.jsx("div",{className:"p-4 cursor-pointer hover:bg-background-dark transition-colors duration-200",onClick:()=>(e=>{const t=e._id||e.id;t===l?o(null):(o(t),a(t),r(null))})(s),children:d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("div",{className:"flex-grow",children:[d.jsx("h3",{className:"text-lg font-semibold text-content-dark",children:s.name}),d.jsx("ul",{className:"mt-2 space-y-1",children:null==(n=s.features)?void 0:n.map(((e,t)=>d.jsxs("li",{className:"flex items-center text-sm text-content-light",children:[d.jsx(h,{className:"w-4 h-4 mr-2 text-primary-light"}),e]},`${i}-feature-${t}`)))})]}),d.jsxs("div",{className:"flex flex-col items-end ml-4",children:[d.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT",children:["$",y(s)]}),d.jsx("div",{className:"mt-2",children:l===i?d.jsx(x,{className:"w-5 h-5 text-content-light"}):d.jsx(u,{className:"w-5 h-5 text-content-light"})})]})]})}),d.jsx(p,{children:l===i&&d.jsx(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-border-light",children:d.jsxs("div",{className:"p-4 bg-background-DEFAULT",children:[d.jsx("h4",{className:"text-sm font-semibold text-content-DEFAULT mb-3",children:"Select your preferred scent:"}),d.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:v.map((e=>d.jsx(m.button,{onClick:t=>((e,t)=>{e.stopPropagation(),r(t)})(t,e.id),className:`\n                            p-3 rounded-lg text-sm font-medium transition-all duration-200\n                            ${t===e.id?"bg-primary-light text-white shadow-lg shadow-primary-light/30":"bg-background-light text-content-DEFAULT hover:bg-background-dark border border-border-light"}\n                          `,whileHover:{scale:1.02},whileTap:{scale:.98},children:d.jsx("span",{className:"block text-center",children:e.name})},`scent-${e.id}`)))})]})})})]},i)})),i&&d.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 backdrop-blur-sm border-t border-border-light",children:d.jsx(m.button,{onClick:n,className:"w-full p-3 rounded-lg bg-primary-light text-white hover:bg-primary-DEFAULT transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue"})})]})},L=({bookingDetails:e,onInputChange:t,captcha:a,onSubmit:r,isFormValid:s,onBack:n})=>{const[i,c]=S.useState(""),[h,x]=S.useState(null),[p,b]=S.useState(null),[g,v]=S.useState({name:!1,contact:!1,makeModel:!1,date:!1,time:!1,captcha:!1,email:!1}),j=/^(\+?1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,y=e=>{if(!e)return!0;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},N=e=>{v((t=>o(l({},t),{[e]:!0})))},f=(e,a)=>{if(e&&a){const r=`${new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}, ${a}`;t({target:{name:"dateTime",value:r}})}},k="\n    w-full p-3 pl-4 pr-10 border border-border-DEFAULT rounded-lg \n    bg-background-light focus:ring-2 focus:ring-primary-light \n    text-content-DEFAULT appearance-none cursor-pointer \n    hover:border-border-dark transition-colors\n  ",w="\n    w-full p-3 border rounded-lg focus:outline-none focus:ring-2 \n    focus:ring-primary-light bg-background-light border-border-DEFAULT\n    text-content-DEFAULT placeholder:text-content-light\n  ";return d.jsxs("div",{className:"relative pb-32",children:[" ",d.jsxs(m.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[d.jsx("h2",{className:"text-2xl font-bold mb-4 text-content-dark",children:"Booking Details"}),d.jsx("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",noValidate:!0,children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"relative",children:[d.jsx("label",{htmlFor:"name",className:"sr-only",children:"Your Name"}),d.jsx("input",{type:"text",id:"name",name:"name",placeholder:"Your Name",value:e.name,onChange:t,onBlur:()=>N("name"),required:!0,minLength:2,pattern:"^[a-zA-Z\\s]*$",className:w,"aria-describedby":"nameError"}),g.name&&0===e.name.length&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"nameError",children:"Name is required"}),g.name&&e.name.length>0&&!e.name.match(/^[a-zA-Z\s]*$/)&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"nameError",children:"Please enter a valid name (letters only)"})]}),d.jsxs("div",{className:"relative",children:[d.jsx("label",{htmlFor:"contact",className:"sr-only",children:"Contact Number"}),d.jsx("input",{type:"tel",id:"contact",name:"contact",placeholder:"Contact Number (e.g., 123-456-7890)",value:e.contact,onChange:t,onBlur:()=>N("contact"),required:!0,className:w,"aria-describedby":"contactError"}),g.contact&&0===e.contact.length&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"contactError",children:"Phone number is required"}),g.contact&&e.contact.length>0&&(T=e.contact,!j.test(T))&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"contactError",children:"Please enter a valid US phone number (e.g., 123-456-7890)"})]}),d.jsxs("div",{className:"relative",children:[d.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email Address"}),d.jsx("input",{type:"email",id:"email",name:"email",placeholder:"Email Address (Optional)",value:e.email||"",onChange:t,onBlur:()=>N("email"),className:w,"aria-describedby":"emailError"}),g.email&&e.email&&!y(e.email)&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"emailError",children:"Please enter a valid email address"})]}),d.jsxs("div",{className:"relative",children:[d.jsx("label",{htmlFor:"makeModel",className:"sr-only",children:"Car Make and Model"}),d.jsx("input",{type:"text",id:"makeModel",name:"makeModel",placeholder:"Car Make and Model",value:e.makeModel,onChange:t,onBlur:()=>N("makeModel"),required:!0,minLength:2,className:w,"aria-describedby":"makeModelError"}),g.makeModel&&0===e.makeModel.length&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"makeModelError",children:"Car make and model is required"})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("div",{className:"relative flex-1",children:[d.jsx("label",{htmlFor:"date",className:"sr-only",children:"Select Date"}),d.jsxs("select",{id:"date",value:h||"",onChange:e=>{const t=e.target.value;x(t),f(t,p)},onBlur:()=>N("date"),required:!0,className:k,"aria-describedby":"dateError",children:[d.jsx("option",{value:"",disabled:!0,children:"Select Date"}),(()=>{const e=[],t=new Date;for(let a=1;a<8;a++){const r=new Date(t);r.setDate(t.getDate()+a);const s=r.toISOString().split("T")[0],n=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});e.push({value:s,display:n})}return e})().map(((e,t)=>d.jsx("option",{value:e.value,children:e.display},t)))]}),d.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:d.jsx(u,{className:"h-4 w-4 text-content-light"})}),g.date&&!h&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"dateError",children:"Please select a date"})]}),d.jsxs("div",{className:"relative flex-1",children:[d.jsx("label",{htmlFor:"time",className:"sr-only",children:"Select Time"}),d.jsxs("select",{id:"time",value:p||"",onChange:e=>{const t=e.target.value;b(t),f(h,t)},onBlur:()=>N("time"),required:!0,className:k,"aria-describedby":"timeError",children:[d.jsx("option",{value:"",disabled:!0,children:"Select Time"}),["9:00 AM","10:00 AM","11:00 AM","12:00 PM","1:00 PM","2:00 PM","3:00 PM","4:00 PM","5:00 PM"].map(((e,t)=>d.jsx("option",{value:e,children:e},t)))]}),d.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:d.jsx(u,{className:"h-4 w-4 text-content-light"})}),g.time&&!p&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"timeError",children:"Please select a time"})]})]}),d.jsxs("div",{className:"bg-background-DEFAULT p-4 rounded-lg border border-border-DEFAULT",children:[d.jsx("label",{htmlFor:"captcha",className:"block mb-2 font-semibold text-content-dark",children:a.question}),d.jsx("input",{type:"text",id:"captcha",value:i,onChange:e=>c(e.target.value),onBlur:()=>N("captcha"),required:!0,className:w,placeholder:"Enter CAPTCHA answer","aria-describedby":"captchaError"}),g.captcha&&!i&&d.jsx("span",{className:"text-red-500 text-sm mt-1",id:"captchaError",children:"Please answer the CAPTCHA"})]})]})})]}),d.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 backdrop-blur-sm border-t border-border-light",children:d.jsxs("div",{className:"max-w-[1000px] mx-auto space-y-3",children:[d.jsx(m.button,{type:"button",onClick:t=>{if(t.preventDefault(),v(o(l({},g),{email:!0})),s&&(!e.email||y(e.email))){const e=i.trim();r(e)}},disabled:!s,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(s?"bg-primary-light text-white hover:bg-primary-DEFAULT":"bg-background-dark text-content-light cursor-not-allowed"),whileHover:s?{scale:1.02}:{},whileTap:s?{scale:.98}:{},children:"Complete Booking"}),d.jsx(m.button,{type:"button",onClick:e=>{e.preventDefault(),n()},className:"w-full p-3 rounded-lg bg-background-DEFAULT text-content-DEFAULT border border-border-DEFAULT hover:bg-background-dark transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Addons"})]})})]});var T},U=({booking:e})=>e?d.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-2xl mx-auto",children:[d.jsxs("div",{className:"mb-8",children:[d.jsx("div",{className:"w-16 h-16 bg-primary-light rounded-full mx-auto flex items-center justify-center mb-4",children:d.jsx(b,{className:"w-10 h-10 text-white"})}),d.jsx("h2",{className:"text-3xl font-bold mb-2 text-content-dark",children:"Booking Confirmed!"}),d.jsxs("p",{className:"text-lg text-content-light",children:["Confirmation number:"," ",d.jsx("span",{className:"text-primary-DEFAULT font-mono font-bold text-lg",children:e.confirmationNumber})]})]}),d.jsxs("div",{className:"bg-background-DEFAULT rounded-lg p-6 mb-8 border border-border-light shadow-sm",children:[d.jsx("h3",{className:"text-2xl font-semibold mb-6 text-content-dark",children:"Booking Details"}),d.jsxs("div",{className:"space-y-6 text-left",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(g,{className:"w-5 h-5 text-primary-light"}),d.jsx("span",{className:"text-content-DEFAULT",children:e.name}),e.email&&d.jsx("span",{className:"text-sm text-content-light block",children:e.email})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(v,{className:"w-5 h-5 text-primary-light"}),d.jsx("span",{className:"text-content-DEFAULT",children:e.contact})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(j,{className:"w-5 h-5 text-primary-light"}),d.jsxs("div",{children:[d.jsx("span",{className:"text-content-DEFAULT",children:e.makeModel}),d.jsxs("span",{className:"text-sm text-content-light block",children:["Type: ",e.vehicleType]})]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(y,{className:"w-5 h-5 text-primary-light"}),d.jsx("span",{className:"text-content-DEFAULT",children:e.dateTime})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(N,{className:"w-5 h-5 text-primary-light"}),d.jsxs("div",{children:[d.jsxs("p",{className:"font-medium text-content-DEFAULT",children:[e.serviceName," - $",e.servicePrice]}),d.jsxs("p",{className:"text-sm text-content-light mt-1",children:["Selected scent: ",e.selectedScent]})]})]}),e.optionalServices&&e.optionalServices.length>0&&d.jsxs("div",{className:"mt-4 pt-4 border-t border-border-light",children:[d.jsx("h4",{className:"text-lg font-medium mb-2 text-content-dark",children:"Optional Services"}),e.optionalServices.map(((e,t)=>d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-content-DEFAULT",children:e.name}),d.jsxs("span",{className:"text-primary-DEFAULT",children:["$",e.price]})]},t)))]}),d.jsx("div",{className:"mt-6 pt-6 border-t border-border-light",children:d.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[d.jsx("span",{className:"text-content-dark",children:"Total Price:"}),d.jsxs("span",{className:"text-primary-DEFAULT",children:["$",e.totalPrice]})]})})]})]}),d.jsxs("div",{className:"flex gap-4 mt-8",children:[d.jsxs("button",{onClick:()=>c(void 0,null,(function*(){try{const t=yield fetch(`${E.API_URL}${E.ENDPOINTS.BOOKINGS.PDF(e.confirmationNumber)}`,{headers:{Accept:"application/pdf"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=yield t.blob(),r=window.URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=`booking-${e.confirmationNumber}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}catch(t){alert("Failed to download confirmation. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 bg-primary-light text-white rounded-lg hover:bg-primary-DEFAULT transition-colors",children:[d.jsx(f,{className:"w-4 h-4"}),"Download Confirmation"]}),e.email&&d.jsxs("button",{onClick:()=>c(void 0,null,(function*(){try{const t=yield A.post(E.ENDPOINTS.BOOKINGS.RESEND_EMAIL(e.confirmationNumber));if(!t.success)throw new Error(t.error||"Failed to send email");alert("Email sent successfully!")}catch(t){alert("Failed to send email. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 bg-background-DEFAULT text-content-DEFAULT border border-border-DEFAULT rounded-lg hover:bg-background-dark transition-colors",children:[d.jsx(k,{className:"w-4 h-4"}),"Send Email"]})]}),d.jsxs("div",{className:"space-y-4 text-content-light text-base mt-10",children:[d.jsxs("p",{children:["Please save your confirmation number:"," ",d.jsx("span",{className:"font-mono font-bold text-primary-DEFAULT",children:e.confirmationNumber})]}),d.jsx("p",{children:"We look forward to servicing your vehicle at the scheduled time."}),d.jsx("p",{children:"Please arrive 5-10 minutes before your appointment time."})]}),d.jsx(m.button,{onClick:()=>window.location.reload(),className:"mt-8 bg-background-DEFAULT border border-border-DEFAULT px-6 py-3 rounded-lg \n                 hover:bg-background-dark transition-colors text-content-DEFAULT",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Book Another Service"})]}):d.jsx("div",{className:"text-center py-8 text-red-500",children:"Booking information not available"}),P=({selectedType:e,onTypeChange:t})=>{const{vehicleTypes:a,loading:r}=D();return r?d.jsx("div",{children:"Loading vehicle types..."}):d.jsxs("div",{className:"relative mb-6",children:[d.jsx("label",{htmlFor:"vehicleType",className:"block text-sm font-medium text-content-DEFAULT mb-2",children:"Select Vehicle Type"}),d.jsxs("div",{className:"relative",children:[d.jsx("select",{id:"vehicleType",value:e,onChange:e=>t(e.target.value),className:"w-full p-3 pr-10 bg-background-light border border-border-DEFAULT \n                   rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-primary-light \n                   text-content-DEFAULT cursor-pointer hover:border-border-dark transition-colors",children:a.map((e=>d.jsx("option",{value:e.id,children:e.label},e.id)))}),d.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:d.jsx(u,{className:"h-5 w-5 text-content-light"})})]})]})},M=({selectedOptions:e,onOptionSelect:t,onContinue:a,onBack:r})=>{const{optionalServices:s,loading:n}=D();return n?d.jsx("div",{children:"Loading optional services..."}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"space-y-4",children:s.map((a=>d.jsx(m.div,{className:"relative p-4 rounded-lg border-2 cursor-pointer transition-colors duration-200\n              "+(e.includes(a.id.toString())?"border-primary-light bg-primary-light/5":"border-border-DEFAULT bg-background-light hover:border-border-dark"),onClick:()=>{return r=a.id.toString(),void(e.includes(r)?t(e.filter((e=>e!==r))):t([...e,r]));var r},whileHover:{scale:1.01},whileTap:{scale:.99},children:d.jsxs("div",{className:"flex items-start justify-between gap-4",children:[d.jsxs("div",{className:"flex-grow",children:[d.jsx("h4",{className:"text-lg font-medium text-content-dark",children:a.name}),d.jsx("p",{className:"text-sm text-content-light mt-1",children:a.description})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT",children:["$",a.price]}),d.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center\n                  "+(e.includes(a.id.toString())?"bg-primary-light":"border-2 border-border-DEFAULT"),children:e.includes(a.id.toString())?d.jsx(b,{className:"w-4 h-4 text-white"}):d.jsx(w,{className:"w-4 h-4 text-content-light"})})]})]})},a.id)))}),e.length>0&&d.jsx("div",{className:"py-3 border-t border-border-light",children:d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("p",{className:"text-sm text-content-light",children:"Additional Services Total:"}),d.jsxs("p",{className:"text-xl font-bold text-primary-DEFAULT",children:["$",s.filter((t=>e.includes(t.id.toString()))).reduce(((e,t)=>e+parseFloat(t.price)),0).toFixed(2)]})]})}),d.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 backdrop-blur-sm border-t border-border-light",children:d.jsxs("div",{className:"space-y-3",children:[d.jsx(m.button,{onClick:a,className:"w-full p-3 rounded-lg bg-primary-light text-white hover:bg-primary-DEFAULT transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue to Booking Details"}),d.jsx(m.button,{onClick:r,className:"w-full p-3 rounded-lg bg-background-DEFAULT text-content-DEFAULT border border-border-DEFAULT hover:bg-background-dark transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Services"})]})})]})},O=()=>{const e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random()),a=["+","-","*"],r=a[Math.floor(Math.random()*a.length)];let s;switch(r){case"+":default:s=e+t;break;case"-":s=e-t;break;case"*":s=e*t}return{question:`What is ${e} ${r} ${t}?`,answer:s.toString()}},B=()=>{const{bookingStep:e,selectedVehicleType:t,selectedService:a,selectedScent:r,selectedOptions:s,bookingDetails:n,booking:i,captcha:h,loading:x,error:u,optionalServicesData:b,handleVehicleTypeChange:g,handleNext:v,handleBack:j,setSelectedService:y,setSelectedScent:N,handleOptionSelect:f,handleInputChange:k,handleBookingSubmit:w,canProceedToDetails:T,isFormValid:A}=(()=>{var e;const{services:t}=F(),{vehicleTypes:a,scents:r,optionalServices:s}=D(),[n,i]=S.useState((null==(e=a[0])?void 0:e.id)||"sedan"),[d,m]=S.useState([]),[h,x]=S.useState("service"),[u,p]=S.useState(null),[b,g]=S.useState(null),[v,j]=S.useState({name:"",contact:"",email:"",makeModel:"",dateTime:""}),[y,N]=S.useState(null),[f,k]=S.useState(!1),[w,T]=S.useState(null),[A,C]=S.useState({question:"",answer:""});S.useEffect((()=>{C(O())}),[]),S.useEffect((()=>{m([])}),[u,n]);const L=u&&b,U=Object.values(v).every(Boolean);return{bookingStep:h,selectedVehicleType:n,selectedService:u,selectedScent:b,selectedOptions:d,bookingDetails:v,captcha:A,booking:y,loading:f,error:w,optionalServices:s,vehicleTypes:a,scents:r,setSelectedService:p,setSelectedScent:g,setSelectedOptions:m,handleVehicleTypeChange:e=>{i(e),p(null),g(null)},handleBack:()=>{switch(h){case"options":x("service");break;case"details":x("options")}},handleOptionSelect:e=>{m(e)},handleNext:()=>{switch(h){case"service":L&&x("options");break;case"options":x("details")}},handleInputChange:e=>{const{name:t,value:a}=e.target;j((e=>o(l({},e),{[t]:a})))},handleBookingSubmit:e=>c(void 0,null,(function*(){if(e!==A.answer)return C(O()),T("CAPTCHA verification failed. Please try again."),{success:!1,error:"CAPTCHA verification failed"};k(!0),T(null);try{const e=t.find((e=>e._id===u||e.id===u)),a=r.find((e=>e.id===b)),i=(null==a?void 0:a.name)||"None",l=d.map((e=>{const t=s.find((t=>t.id.toString()===e.toString()));return{serviceId:t.id,name:t.name,price:parseFloat(t.price)}})),o=e.vehiclePricing[n],c=o+l.reduce(((e,t)=>e+t.price),0),m=new Date,h=`BK-${(m.getMonth()+1).toString().padStart(2,"0")+m.getDate().toString().padStart(2,"0")+m.getFullYear().toString()}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`,p={name:v.name,contact:v.contact,email:v.email||null,vehicleType:n,makeModel:v.makeModel,dateTime:v.dateTime,serviceId:u,serviceName:null==e?void 0:e.name,selectedScent:i||"None",servicePrice:o,features:e.features,optionalServices:l,totalPrice:c,confirmationNumber:h,status:"pending"},g=yield fetch(`${E.API_URL}${E.ENDPOINTS.BOOKINGS.BASE}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),j=yield g.json();if(j.success)return N(p),x("confirmation"),{success:!0,booking:p};throw new Error(j.error||"Failed to create booking")}catch(a){return T(a.message),{success:!1,error:a.message}}finally{k(!1)}})),resetBookingState:()=>{x("service"),p(null),g(null),m([]),j({name:"",contact:"",makeModel:"",dateTime:""}),N(null),T(null),C(O())},canProceedToDetails:L,isFormValid:U}})();S.useEffect((()=>{if("details"===e||"options"===e||"confirmation"===e){const e=document.getElementById("booking-component");if(e){const t=-80,a=e.getBoundingClientRect().top+window.pageYOffset+t;window.scrollTo({top:a,behavior:"smooth"})}}}),[e]);return d.jsxs("div",{id:"booking-component",className:"card max-w-[1000px] mx-auto",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-content-dark",children:"options"===e?"Enhance Your Service":"Choose Your Service Type"}),d.jsx("p",{className:"text-content-light mt-2",children:"options"===e?"Add optional services to customize your experience":"Select the service option that best fits your schedule"})]}),d.jsx(p,{mode:"wait",children:d.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"pb-24",children:x?d.jsx("div",{className:"flex justify-center items-center py-20",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light"})}):(()=>{switch(e){case"service":return d.jsxs(d.Fragment,{children:[d.jsx(P,{selectedType:t,onTypeChange:g}),d.jsx(C,{selectedService:a,selectedScent:r,onServiceSelect:y,onScentSelect:N,selectedVehicleType:t})]});case"options":return d.jsx(d.Fragment,{children:d.jsx(M,{optionalServices:b,selectedOptions:s,onOptionSelect:f,onContinue:v,onBack:j})});case"details":return d.jsx(d.Fragment,{children:d.jsx(L,{bookingDetails:n,onInputChange:k,captcha:h,onSubmit:w,isFormValid:A,onBack:j})});case"confirmation":return d.jsx(U,{booking:i});default:return null}})()},e)}),"confirmation"===e?null:d.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 backdrop-blur-sm border-t border-border-light",children:"service"===e&&d.jsx(m.button,{onClick:v,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(T?"bg-primary-light text-white hover:bg-primary-DEFAULT":"bg-background-dark text-content-light cursor-not-allowed"),whileHover:T?{scale:1.02}:{},whileTap:T?{scale:.98}:{},disabled:!T,children:T?"Continue":"Select a package and scent to continue"})}),u&&d.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 p-4 rounded-lg mb-4",children:u})]})};export{B as default};
