var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,i=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&o(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&o(e,r,t[r]);return e},l=(e,a)=>t(e,r(a)),d=(e,t,r)=>new Promise(((a,n)=>{var s=e=>{try{i(r.next(e))}catch(t){n(t)}},o=e=>{try{i(r.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,o);i((r=r.apply(e,t)).next())}));import{j as c,v as m,w as h,x,y as g,z as u,E as b,H as p,I as k,J as v,C as j,K as y,N as f,O as N,P as w}from"../vendor/ui-vendor-odwtWphe.js";import{r as S}from"../vendor/react-vendor-D7383juu.js";import{a as T,C as E}from"../index-BFy2tfFm.js";import{u as D}from"./useConfig-Bpyg_xQl.js";import"../vendor/auth-vendor-sPk1YpsG.js";const F=()=>{const e=S.useContext(T);if(void 0===e)throw new Error("useServices must be used within a ServicesProvider");return e},A=({selectedService:e,selectedScent:t,onServiceSelect:r,onScentSelect:a,selectedVehicleType:n,onContinue:s,canProceedToDetails:o})=>{const[i,l]=S.useState(null),{services:d,loading:b,error:p}=F(),{scents:k,loading:v}=D();S.useEffect((()=>{l(null),r(null),a(null)}),[n]);const j=e=>{var t;return(null==(t=null==e?void 0:e.vehiclePricing)?void 0:t[n])||0};return b?c.jsx("div",{className:"flex justify-center items-center h-64",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):p?c.jsx("div",{className:"text-center py-8 text-red-600 dark:text-red-400",children:p}):c.jsxs("div",{className:"space-y-4",children:[d.map((n=>{var s;const o=n._id||n.id;return c.jsxs(m.div,{className:`\n              rounded-lg overflow-hidden relative  \n              ${e===o?"ring-2 ring-primary-light dark:ring-orange-500":""}\n            `,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[c.jsx("div",{className:"p-4 cursor-pointer border border-border-light dark:border-stone-700 rounded-lg \n                         bg-background-light dark:bg-stone-800\n                         hover:bg-background-dark dark:hover:bg-stone-700 transition-colors duration-200",onClick:()=>(e=>{const t=e._id||e.id;t===i?l(null):(l(t),r(t),a(null))})(n),children:c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{className:"flex-grow",children:[c.jsx("h3",{className:"text-lg font-semibold text-content-dark dark:text-white",children:n.name}),c.jsx("ul",{className:"mt-2 space-y-1",children:null==(s=n.features)?void 0:s.map(((e,t)=>c.jsxs("li",{className:"flex items-center text-sm text-content-light dark:text-stone-400",children:[c.jsx(h,{className:"w-4 h-4 mr-2 text-primary-light dark:text-orange-500"}),e]},`${o}-feature-${t}`)))})]}),c.jsxs("div",{className:"flex flex-col items-end ml-4",children:[c.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",j(n)]}),c.jsx("div",{className:"mt-2",children:i===o?c.jsx(x,{className:"w-5 h-5 text-content-light dark:text-stone-500"}):c.jsx(g,{className:"w-5 h-5 text-content-light dark:text-stone-500"})})]})]})}),c.jsx(u,{children:i===o&&c.jsx(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-border-light dark:border-stone-700",children:c.jsxs("div",{className:"p-4 bg-background-DEFAULT dark:bg-stone-900",children:[c.jsx("h4",{className:"text-sm font-semibold text-content-DEFAULT dark:text-white mb-3",children:"Select your preferred scent:"}),c.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:k.map((e=>c.jsx(m.button,{onClick:t=>((e,t)=>{e.stopPropagation(),a(t)})(t,e.id),className:`\n                            p-3 rounded-lg text-sm font-medium transition-all duration-200\n                            ${t===e.id?"bg-primary-light dark:bg-orange-500 text-white shadow-lg shadow-primary-light/30 dark:shadow-orange-500/30":"bg-background-light dark:bg-stone-800 text-content-DEFAULT dark:text-stone-300 hover:bg-background-dark dark:hover:bg-stone-700 border border-border-light dark:border-stone-700"}\n                          `,whileHover:{scale:1.02},whileTap:{scale:.98},children:c.jsx("span",{className:"block text-center",children:e.name})},`scent-${e.id}`)))})]})})})]},o)})),o&&c.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:c.jsx(m.button,{onClick:s,className:"w-full p-3 rounded-lg bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600 transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue"})})]})},C=({bookingDetails:e,onInputChange:t,captcha:r,onSubmit:a,isFormValid:n,onBack:s})=>{var o,h,x;const[u,b]=S.useState(""),[p,k]=S.useState(null),[v,j]=S.useState(null),[y,f]=S.useState({name:!1,contact:!1,makeModel:!1,date:!1,time:!1,captcha:!1,email:!1}),[N,w]=S.useState({}),T=/^(\+?1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,D=e=>{if(!e)return!0;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},F=n&&u.trim().length>0,A=["9:00 AM","10:00 AM","11:00 AM","12:00 PM","1:00 PM","2:00 PM","3:00 PM","4:00 PM","5:00 PM"],C=e=>{f((t=>l(i({},t),{[e]:!0})))},P=(e,r)=>d(void 0,null,(function*(){if(e&&r){const n=`${new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})}, ${r}`;try{const e=yield fetch(`${E.API_URL}/bookings/check-slot?dateTime=${encodeURIComponent(n)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=yield e.json();if(!r.success)throw new Error(r.error||"Failed to check slot availability");if(!r.available)return alert(`This time slot is fully booked (${r.currentBookings}/${r.maxBookingsPerSlot} bookings). Please select another time.`),void j(null);t({target:{name:"dateTime",value:n}}),f((e=>l(i({},e),{date:!0,time:!0})))}catch(a){alert(`Error checking time slot availability: ${a.message}`),j(null)}}})),L=(null==(o=e.name)?void 0:o.trim())&&(null==(h=e.contact)?void 0:h.trim())&&(null==(x=e.makeModel)?void 0:x.trim())&&p&&v&&u.trim(),U="\n  w-full p-3 rounded-lg shadow-sm transition-colors duration-200\n  focus:outline-none focus:ring-2 focus:ring-primary-light dark:focus:ring-orange-500\n  bg-white dark:bg-stone-800 \n  text-content-DEFAULT dark:text-white \n  placeholder:text-content-light dark:placeholder:text-stone-400\n  hover:bg-gray-50 dark:hover:bg-stone-700/50\n",$="\n  w-full p-3 rounded-lg shadow-sm transition-colors duration-200\n  focus:outline-none focus:ring-2 focus:ring-primary-light dark:focus:ring-orange-500\n  bg-white dark:bg-stone-800 \n  text-content-DEFAULT dark:text-white \n  placeholder:text-content-light dark:placeholder:text-stone-400\n  hover:bg-gray-50 dark:hover:bg-stone-700/50\n";return c.jsxs("div",{className:"relative",children:[" ",c.jsxs(m.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[c.jsx("h2",{className:"text-2xl font-bold mb-4 text-content-dark dark:text-white",children:"Booking Details"}),c.jsx("form",{onSubmit:e=>e.preventDefault(),className:"space-y-4",noValidate:!0,children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"relative",children:[c.jsx("label",{htmlFor:"name",className:"sr-only",children:"Your Name"}),c.jsx("input",{type:"text",id:"name",name:"name",placeholder:"Your Name",value:e.name,onChange:t,onBlur:()=>C("name"),required:!0,minLength:2,pattern:"^[a-zA-Z\\s]*$",className:U,"aria-describedby":"nameError"}),y.name&&0===e.name.length&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"nameError",children:"Name is required"}),y.name&&e.name.length>0&&!e.name.match(/^[a-zA-Z\s]*$/)&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"nameError",children:"Please enter a valid name (letters only)"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("label",{htmlFor:"contact",className:"sr-only",children:"Contact Number"}),c.jsx("input",{type:"tel",id:"contact",name:"contact",placeholder:"Contact Number (e.g., 123-456-7890)",value:e.contact,onChange:t,onBlur:()=>C("contact"),required:!0,className:U,"aria-describedby":"contactError"}),y.contact&&0===e.contact.length&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"contactError",children:"Phone number is required"}),y.contact&&e.contact.length>0&&(M=e.contact,!T.test(M))&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"contactError",children:"Please enter a valid US phone number (e.g., 123-456-7890)"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email Address"}),c.jsx("input",{type:"email",id:"email",name:"email",placeholder:"Email Address (Optional)",value:e.email||"",onChange:t,onBlur:()=>C("email"),className:U,"aria-describedby":"emailError"}),y.email&&e.email&&!D(e.email)&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"emailError",children:"Please enter a valid email address"})]}),c.jsxs("div",{className:"relative",children:[c.jsx("label",{htmlFor:"makeModel",className:"sr-only",children:"Car Make and Model"}),c.jsx("input",{type:"text",id:"makeModel",name:"makeModel",placeholder:"Car Make and Model",value:e.makeModel,onChange:t,onBlur:()=>C("makeModel"),required:!0,minLength:2,className:U,"aria-describedby":"makeModelError"}),y.makeModel&&0===e.makeModel.length&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"makeModelError",children:"Car make and model is required"})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("div",{className:"relative flex-1",children:[c.jsx("label",{htmlFor:"date",className:"sr-only",children:"Select Date"}),c.jsxs("select",{id:"date",value:p||"",onChange:e=>{const t=e.target.value;k(t),P(t,v)},onBlur:()=>C("date"),required:!0,className:$,"aria-describedby":"dateError",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Date"}),(()=>{const e=[],t=new Date;for(let r=1;r<8;r++){const a=new Date(t);a.setDate(t.getDate()+r);const n=a.toISOString().split("T")[0],s=a.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});e.push({value:n,display:s})}return e})().map(((e,t)=>c.jsx("option",{value:e.value,children:e.display},t)))]}),c.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:c.jsx(g,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-content-light dark:text-stone-400 pointer-events-none"})}),y.date&&!p&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"dateError",children:"Please select a date"})]}),c.jsxs("div",{className:"relative flex-1",children:[c.jsx("label",{htmlFor:"time",className:"sr-only",children:"Select Time"}),c.jsxs("select",{id:"time",value:v||"",onChange:e=>{const t=e.target.value;j(t),P(p,t)},onBlur:()=>C("time"),required:!0,className:$,"aria-describedby":"timeError",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Time"}),A.map(((e,t)=>{var r;const a=!1!==(null==(r=N[`${p}, ${e}`])?void 0:r.available);return c.jsxs("option",{value:e,disabled:!a,children:[e," ",a?"":"(Fully Booked)"]},t)}))]}),c.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:c.jsx(g,{className:"h-4 w-4 text-content-light"})}),y.time&&!v&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"timeError",children:"Please select a time"})]})]}),c.jsxs("div",{className:"p-4 rounded-lg border-2 border-border-DEFAULT dark:border-stone-700 bg-background-DEFAULT dark:bg-stone-800",children:[c.jsx("label",{htmlFor:"captcha",className:"block mb-2 font-medium text-content-dark dark:text-white",children:r.question}),c.jsx("input",{type:"text",id:"captcha",value:u,onChange:e=>b(e.target.value),onBlur:()=>C("captcha"),required:!0,className:U,placeholder:"Enter CAPTCHA answer","aria-describedby":"captchaError"}),y.captcha&&!u&&c.jsx("span",{className:"text-red-500 text-sm mt-1",id:"captchaError",children:"Please answer the CAPTCHA"})]})]})})]}),c.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:c.jsxs("div",{className:"max-w-[1000px] mx-auto space-y-3",children:[c.jsx(m.button,{type:"button",onClick:t=>{if(t.preventDefault(),f(l(i({},y),{email:!0,captcha:!0})),L&&(!e.email||D(e.email))){const e=u.trim();a(e)}},disabled:!F,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(F?"bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600":"bg-background-dark dark:bg-stone-800 text-content-light dark:text-stone-500 cursor-not-allowed"),whileHover:F?{scale:1.02}:{},whileTap:F?{scale:.98}:{},children:L?"Complete Booking":"Please Fill All Required Fields"}),c.jsx(m.button,{type:"button",onClick:e=>{e.preventDefault(),s()},className:"w-full p-3 rounded-lg bg-background-DEFAULT dark:bg-stone-800 text-content-DEFAULT dark:text-white border border-border-DEFAULT dark:border-stone-700 hover:bg-background-dark dark:hover:bg-stone-700 transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Addons"})]})})]});var M},P=({booking:e})=>e?c.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-2xl mx-auto",children:[c.jsxs("div",{className:"mb-8",children:[c.jsx("div",{className:"w-16 h-16 bg-primary-light dark:bg-orange-500 rounded-full mx-auto \n                  flex items-center justify-center mb-4",children:c.jsx(b,{className:"w-10 h-10 text-white"})}),c.jsx("h2",{className:"text-3xl font-bold mb-2 text-content-dark dark:text-white",children:"Booking Confirmed!"}),c.jsxs("p",{className:"text-lg text-content-light dark:text-stone-400",children:["Confirmation number:"," ",c.jsx("span",{className:"text-primary-DEFAULT dark:text-orange-500 font-mono font-bold",children:e.confirmationNumber})]})]}),c.jsxs("div",{className:"bg-background-DEFAULT dark:bg-stone-800 rounded-lg p-6 mb-8 \n                border border-border-light dark:border-stone-700 shadow-sm",children:[c.jsx("h3",{className:"text-2xl font-semibold mb-6 text-content-dark dark:text-white",children:"Booking Details"}),c.jsxs("div",{className:"space-y-6 text-left",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(p,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),c.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.name}),e.email&&c.jsx("span",{className:"text-sm text-content-light block",children:e.email})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(k,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),c.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.contact})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(v,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),c.jsxs("div",{children:[c.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.makeModel}),c.jsxs("span",{className:"text-sm text-content-light block",children:["Type: ",e.vehicleType]})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(j,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),c.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.dateTime})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(y,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),c.jsxs("div",{children:[c.jsxs("p",{className:"font-medium text-content-DEFAULT",children:[e.serviceName," - $",e.servicePrice]}),c.jsxs("p",{className:"text-sm text-content-light mt-1",children:["Selected scent: ",e.selectedScent]})]})]}),e.optionalServices&&e.optionalServices.length>0&&c.jsxs("div",{className:"mt-4 pt-4 border-t border-border-light dark:border-stone-700",children:[c.jsx("h4",{className:"text-lg font-medium mb-2 text-content-dark dark:text-white",children:"Optional Services"}),e.optionalServices.map(((e,t)=>c.jsxs("div",{className:"flex justify-between text-sm",children:[c.jsx("span",{className:"text-content-DEFAULT dark:text-stone-300",children:e.name}),c.jsxs("span",{className:"text-primary-DEFAULT dark:text-orange-500",children:["$",e.price]})]},t)))]}),c.jsx("div",{className:"mt-6 pt-6 border-t border-border-light dark:border-stone-700",children:c.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[c.jsx("span",{className:"text-content-dark dark:text-white",children:"Total Price:"}),c.jsxs("span",{className:"text-primary-DEFAULT dark:text-orange-500",children:["$",e.totalPrice]})]})})]})]}),c.jsxs("div",{className:"flex gap-4 mt-8",children:[c.jsxs("button",{onClick:()=>d(void 0,null,(function*(){try{const t=yield fetch(`${E.API_URL}${E.ENDPOINTS.BOOKINGS.PDF(e.confirmationNumber)}`,{headers:{Accept:"application/pdf"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=yield t.blob(),a=window.URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=`booking-${e.confirmationNumber}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(t){alert("Failed to download confirmation. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 \n          bg-primary-light dark:bg-orange-500 text-white rounded-lg \n          hover:bg-primary-DEFAULT dark:hover:bg-orange-600 \n          transition-colors",children:[c.jsx(f,{className:"w-4 h-4"}),"Download Confirmation"]}),e.email&&c.jsxs("button",{onClick:()=>d(void 0,null,(function*(){try{const t=yield fetch(`${E.API_URL}/bookings/${e.confirmationNumber}/resend-email`,{method:"POST",headers:{"Content-Type":"application/json"}}),r=yield t.json();if(!t.ok||!r.success)throw new Error(r.error||"Failed to send email");alert("Email sent successfully!")}catch(t){alert("Failed to send email. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 \n            bg-background-DEFAULT dark:bg-stone-800 \n            text-content-DEFAULT dark:text-white \n            border border-border-DEFAULT dark:border-stone-700 rounded-lg \n            hover:bg-background-dark dark:hover:bg-stone-700 \n            transition-colors",children:[c.jsx(N,{className:"w-4 h-4"}),"Send Email"]})]}),c.jsxs("div",{className:"space-y-4 text-content-light text-base mt-10",children:[c.jsxs("p",{children:["Please save your confirmation number:"," ",c.jsx("span",{className:"font-mono font-bold text-primary-DEFAULT",children:e.confirmationNumber})]}),c.jsx("p",{children:"We look forward to servicing your vehicle at the scheduled time."}),c.jsx("p",{children:"Please arrive 5-10 minutes before your appointment time."})]}),c.jsx(m.button,{onClick:()=>window.location.reload(),className:"mt-8 bg-background-DEFAULT border border-border-DEFAULT px-6 py-3 rounded-lg \n                 hover:bg-background-dark transition-colors text-content-DEFAULT",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Book Another Service"})]}):c.jsx("div",{className:"text-center py-8 text-red-500",children:"Booking information not available"}),L=({selectedType:e,onTypeChange:t})=>{const{vehicleTypes:r,loading:a}=D();return a?c.jsx("div",{className:"flex justify-center items-center py-4",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):c.jsxs("div",{className:"relative mb-6",children:[c.jsx("label",{htmlFor:"vehicleType",className:"block text-sm font-medium text-content-dark dark:text-white mb-2",children:"Select Vehicle Type"}),c.jsxs("div",{className:"relative",children:[c.jsx("select",{id:"vehicleType",value:e,onChange:e=>t(e.target.value),className:"w-full p-3 pr-10 rounded-lg border-2 transition-colors duration-200\n            bg-background-light dark:bg-stone-800\n            border-border-DEFAULT dark:border-stone-700\n            text-content-DEFAULT dark:text-white\n            hover:border-border-dark dark:hover:border-stone-600\n            focus:outline-none focus:border-primary-light dark:focus:border-orange-500\n            appearance-none cursor-pointer",children:r.map((e=>c.jsx("option",{value:e.id,className:"bg-background-light dark:bg-stone-800",children:e.label},e.id)))}),c.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:c.jsx(g,{className:"h-5 w-5 text-content-light dark:text-stone-400"})})]})]})},U=({selectedOptions:e,onOptionSelect:t,onContinue:r,onBack:a})=>{const{optionalServices:n,loading:s}=D();return s?c.jsx("div",{children:"Loading optional services..."}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"space-y-4",children:n.map((r=>c.jsx(m.div,{className:"relative p-4 rounded-lg border-2 cursor-pointer transition-colors duration-200\n              "+(e.includes(r.id.toString())?"bg-primary-light/5 dark:bg-orange-500/10 border-primary-light dark:border-orange-500":"bg-white dark:bg-stone-800 border-primary-light/50 dark:border-orange-500/20 hover:border-primary-light/80 dark:hover:border-orange-500/40"),onClick:()=>{return a=r.id.toString(),void(e.includes(a)?t(e.filter((e=>e!==a))):t([...e,a]));var a},whileHover:{scale:1.01},whileTap:{scale:.99},children:c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"flex-grow",children:[c.jsx("h4",{className:"text-lg font-medium text-content-dark dark:text-white",children:r.name}),c.jsx("p",{className:"text-sm text-content-light dark:text-stone-400 mt-1",children:r.description})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",r.price]}),c.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center\n                  "+(e.includes(r.id.toString())?"bg-primary-light dark:bg-orange-500":"border-2 border-primary-light/50 dark:border-orange-500/20"),children:e.includes(r.id.toString())?c.jsx(b,{className:"w-4 h-4 text-content-dark dark:text-white"}):c.jsx(w,{className:"w-4 h-4 text-content-light dark:text-stone-400"})})]})]})},r.id)))}),e.length>0&&c.jsx("div",{className:"py-3 border-t border-primary-light/30 dark:border-stone-700",children:c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("p",{className:"text-sm text-content-light dark:text-stone-400",children:"Additional Services Total:"}),c.jsxs("p",{className:"text-xl font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",n.filter((t=>e.includes(t.id.toString()))).reduce(((e,t)=>e+parseFloat(t.price)),0).toFixed(2)]})]})}),c.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 \n                bg-background-light/95 dark:bg-stone-900/95 \n                backdrop-blur-sm border-t border-primary-light/30 dark:border-stone-700",children:c.jsxs("div",{className:"space-y-3",children:[c.jsx(m.button,{onClick:r,className:"w-full p-3 rounded-lg bg-primary-light dark:bg-orange-500 \n            text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600 \n            transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue to Booking Details"}),c.jsx(m.button,{onClick:a,className:"w-full p-3 rounded-lg bg-background-DEFAULT dark:bg-stone-800 \n            text-content-DEFAULT dark:text-white \n            border border-primary-light/50 dark:border-stone-700 \n            hover:bg-background-dark dark:hover:bg-stone-700 \n            transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Services"})]})})]})},$=()=>{const e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random()),r=["+","-","*"],a=r[Math.floor(Math.random()*r.length)];let n;switch(a){case"+":default:n=e+t;break;case"-":n=e-t;break;case"*":n=e*t}return{question:`What is ${e} ${a} ${t}?`,answer:n.toString()}},M=()=>{const{bookingStep:e,selectedVehicleType:t,selectedService:r,selectedScent:a,selectedOptions:n,bookingDetails:s,booking:o,captcha:h,loading:x,error:g,optionalServicesData:b,handleVehicleTypeChange:p,handleNext:k,handleBack:v,setSelectedService:j,setSelectedScent:y,handleOptionSelect:f,handleInputChange:N,handleBookingSubmit:w,canProceedToDetails:T,isFormValid:M}=(()=>{var e;const{services:t}=F(),{vehicleTypes:r,scents:a,optionalServices:n}=D(),[s,o]=S.useState((null==(e=r[0])?void 0:e.id)||"sedan"),[c,m]=S.useState([]),[h,x]=S.useState("service"),[g,u]=S.useState(!1),[b,p]=S.useState(null),[k,v]=S.useState(null),[j,y]=S.useState({name:"",contact:"",email:"",makeModel:"",dateTime:""}),[f,N]=S.useState(null),[w,T]=S.useState(!1),[A,C]=S.useState(null),[P,L]=S.useState({question:"",answer:""});S.useEffect((()=>{L($())}),[]),S.useEffect((()=>{m([])}),[b,s]);const U=b&&k,M=Object.values(j).every(Boolean)&&j.dateTime&&b&&s&&P.answer;return{bookingStep:h,selectedVehicleType:s,selectedService:b,selectedScent:k,selectedOptions:c,bookingDetails:j,captcha:P,booking:f,loading:w,error:A,optionalServices:n,vehicleTypes:r,scents:a,setSelectedService:p,setSelectedScent:v,setSelectedOptions:m,handleVehicleTypeChange:e=>{o(e),p(null),v(null)},handleBack:()=>{switch(h){case"options":x("service");break;case"details":x("options")}},handleOptionSelect:e=>{m(e)},handleNext:()=>{switch(h){case"service":U&&x("options");break;case"options":x("details")}},handleInputChange:e=>{const{name:t,value:r}=e.target;y((e=>l(i({},e),{[t]:r})))},handleBookingSubmit:e=>d(void 0,null,(function*(){if(e!==P.answer)return L($()),C("CAPTCHA verification failed. Please try again."),{success:!1,error:"CAPTCHA verification failed"};T(!0),C(null);try{const e=yield fetch(`${E.API_URL}/bookings/check-slot?dateTime=${encodeURIComponent(j.dateTime)}`);if(!(yield e.json()).available)throw new Error("This time slot is no longer available. Please select another time.");const r=t.find((e=>e._id===b||e.id===b)),o=a.find((e=>e.id===k)),i=(null==o?void 0:o.name)||"None",l=c.map((e=>{const t=n.find((t=>t.id.toString()===e.toString()));return{serviceId:t.id,name:t.name,price:parseFloat(t.price)}})),d=r.vehiclePricing[s],m=d+l.reduce(((e,t)=>e+t.price),0),h=new Date,g=`BK-${(h.getMonth()+1).toString().padStart(2,"0")+h.getDate().toString().padStart(2,"0")+h.getFullYear().toString()}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`,u={name:j.name,contact:j.contact,email:j.email||null,vehicleType:s,makeModel:j.makeModel,dateTime:j.dateTime,serviceId:b,serviceName:null==r?void 0:r.name,selectedScent:i||"None",servicePrice:d,features:r.features,optionalServices:l,totalPrice:m,confirmationNumber:g,status:"pending"},p=yield fetch(`${E.API_URL}${E.ENDPOINTS.BOOKINGS.BASE}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),v=yield p.json();if(v.success)return N(u),x("confirmation"),{success:!0,booking:u};throw new Error(v.error||"Failed to create booking")}catch(r){return C(r.message),{success:!1,error:r.message}}finally{T(!1)}})),resetBookingState:()=>{x("service"),p(null),v(null),m([]),y({name:"",contact:"",makeModel:"",dateTime:""}),N(null),C(null),L($())},canProceedToDetails:U,isFormValid:M,isCaptchaValid:g}})();S.useEffect((()=>{if("details"===e||"options"===e||"confirmation"===e){const e=document.getElementById("booking-component");if(e){const t=-80,r=e.getBoundingClientRect().top+window.pageYOffset+t;window.scrollTo({top:r,behavior:"smooth"})}}}),[e]);return c.jsxs("div",{id:"booking-component",className:"max-w-[1000px] mx-auto",children:[c.jsxs("div",{className:"text-center mb-8",children:[c.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-content-dark dark:text-white",children:"options"===e?"Enhance Your Service":"Choose Your Service Type"}),c.jsx("p",{className:"text-content-light dark:text-stone-400 mt-2",children:"options"===e?"Add optional services to customize your experience":"Select the service option that best fits your schedule"})]}),c.jsx(u,{mode:"wait",children:c.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"rounded-lg border-border-DEFAULT dark:border-stone-700 bg-background-light dark:bg-stone-800 overflow-hidden",children:x?c.jsx("div",{className:"flex justify-center items-center py-20",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):(()=>{switch(e){case"service":return c.jsxs(c.Fragment,{children:[c.jsx(L,{selectedType:t,onTypeChange:p}),c.jsx(A,{selectedService:r,selectedScent:a,onServiceSelect:j,onScentSelect:y,selectedVehicleType:t})]});case"options":return c.jsx(c.Fragment,{children:c.jsx(U,{optionalServices:b,selectedOptions:n,onOptionSelect:f,onContinue:k,onBack:v})});case"details":return c.jsx(c.Fragment,{children:c.jsx(C,{bookingDetails:s,onInputChange:N,captcha:h,onSubmit:w,isFormValid:M,onBack:v})});case"confirmation":return c.jsx(P,{booking:o});default:return null}})()},e)}),"confirmation"===e?null:c.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:"service"===e&&c.jsx(m.button,{onClick:k,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(T?"bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600":"bg-background-dark dark:bg-stone-800 text-content-light dark:text-stone-500 cursor-not-allowed"),whileHover:T?{scale:1.02}:{},whileTap:T?{scale:.98}:{},disabled:!T,children:T?"Continue":"Select a package and scent to continue"})}),g&&c.jsx("div",{className:"mt-4 p-4 rounded-lg bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800",children:c.jsx("p",{className:"text-red-600 dark:text-red-400",children:g})})]})};export{M as default};
