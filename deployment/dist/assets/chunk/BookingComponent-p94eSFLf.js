var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,o=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&i(e,r,t[r]);if(a)for(var r of a(t))n.call(t,r)&&i(e,r,t[r]);return e},l=(e,a)=>t(e,r(a)),d=(e,t)=>{var r={};for(var i in e)s.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&a)for(var i of a(e))t.indexOf(i)<0&&n.call(e,i)&&(r[i]=e[i]);return r},c=(e,t,r)=>new Promise(((a,s)=>{var n=e=>{try{o(r.next(e))}catch(t){s(t)}},i=e=>{try{o(r.throw(e))}catch(t){s(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);o((r=r.apply(e,t)).next())}));import{j as u,r as m,s as h,t as f,u as g,v as b,w as p,x,y as v,z as y,e as k,D as j,E as w,I as N,P as S}from"../vendor/ui-vendor-gM8F1IDR.js";import{r as A,d as F}from"../vendor/react-vendor-C2p5b_me.js";import{a as _,C as D}from"../index-CAiNdoq8.js";import{u as T}from"./useConfig-d4DFgdep.js";import"../vendor/auth-vendor-sPk1YpsG.js";const V=()=>{const e=A.useContext(_);if(void 0===e)throw new Error("useServices must be used within a ServicesProvider");return e},E=({selectedService:e,selectedScent:t,onServiceSelect:r,onScentSelect:a,selectedVehicleType:s,onContinue:n,canProceedToDetails:i})=>{const[o,l]=A.useState(null),{services:d,loading:c,error:p}=V(),{scents:x,loading:v}=T();A.useEffect((()=>{l(null),r(null),a(null)}),[s]);const y=e=>{var t;return(null==(t=null==e?void 0:e.vehiclePricing)?void 0:t[s])||0};return c?u.jsx("div",{className:"flex justify-center items-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):p?u.jsx("div",{className:"text-center py-8 text-red-600 dark:text-red-400",children:p}):u.jsxs("div",{className:"space-y-4",children:[d.map((s=>{var n;const i=s._id||s.id;return u.jsxs(m.div,{className:`\n              rounded-lg overflow-hidden relative  \n              ${e===i?"ring-2 ring-primary-light dark:ring-orange-500":""}\n            `,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[u.jsx("div",{className:"p-4 cursor-pointer border border-border-light dark:border-stone-700 rounded-lg \n                         bg-background-light dark:bg-stone-800\n                         hover:bg-background-dark dark:hover:bg-stone-700 transition-colors duration-200",onClick:()=>(e=>{const t=e._id||e.id;t===o?l(null):(l(t),r(t),a(null))})(s),children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{className:"flex-grow",children:[u.jsx("h3",{className:"text-lg font-semibold text-content-dark dark:text-white",children:s.name}),u.jsx("ul",{className:"mt-2 space-y-1",children:null==(n=s.features)?void 0:n.map(((e,t)=>u.jsxs("li",{className:"flex items-center text-sm text-content-light dark:text-stone-400",children:[u.jsx(h,{className:"w-4 h-4 mr-2 text-primary-light dark:text-orange-500"}),e]},`${i}-feature-${t}`)))})]}),u.jsxs("div",{className:"flex flex-col items-end ml-4",children:[u.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",y(s)]}),u.jsx("div",{className:"mt-2",children:o===i?u.jsx(f,{className:"w-5 h-5 text-content-light dark:text-stone-500"}):u.jsx(g,{className:"w-5 h-5 text-content-light dark:text-stone-500"})})]})]})}),u.jsx(b,{children:o===i&&u.jsx(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"border-t border-border-light dark:border-stone-700",children:u.jsxs("div",{className:"p-4 bg-background-DEFAULT dark:bg-stone-900",children:[u.jsx("h4",{className:"text-sm font-semibold text-content-DEFAULT dark:text-white mb-3",children:"Select your preferred scent:"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:x.map((e=>u.jsx(m.button,{onClick:t=>((e,t)=>{e.stopPropagation(),a(t)})(t,e.id),className:`\n                            p-3 rounded-lg text-sm font-medium transition-all duration-200\n                            ${t===e.id?"bg-primary-light dark:bg-orange-500 text-white shadow-lg shadow-primary-light/30 dark:shadow-orange-500/30":"bg-background-light dark:bg-stone-800 text-content-DEFAULT dark:text-stone-300 hover:bg-background-dark dark:hover:bg-stone-700 border border-border-light dark:border-stone-700"}\n                          `,whileHover:{scale:1.02},whileTap:{scale:.98},children:u.jsx("span",{className:"block text-center",children:e.name})},`scent-${e.id}`)))})]})})})]},i)})),i&&u.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:u.jsx(m.button,{onClick:n,className:"w-full p-3 rounded-lg bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600 transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue"})})]})};var C=e=>"checkbox"===e.type,L=e=>e instanceof Date,U=e=>null==e;const O=e=>"object"==typeof e;var P=e=>!U(e)&&!Array.isArray(e)&&O(e)&&!L(e),M=e=>P(e)&&e.target?C(e.target)?e.target.checked:e.target.value:e,$=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),B="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function I(e){let t;const r=Array.isArray(e),a="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(B&&(e instanceof Blob||a)||!r&&!P(e))return e;if(t=r?[]:{},r||(e=>{const t=e.constructor&&e.constructor.prototype;return P(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const r in e)e.hasOwnProperty(r)&&(t[r]=I(e[r]));else t=e}return t}var q=e=>Array.isArray(e)?e.filter(Boolean):[],R=e=>void 0===e,H=(e,t,r)=>{if(!t||!P(e))return r;const a=q(t.split(/[,[\].]+?/)).reduce(((e,t)=>U(e)?e:e[t]),e);return R(a)||a===e?R(e[t])?r:e[t]:a},W=e=>"boolean"==typeof e,Y=e=>/^\w*$/.test(e),G=e=>q(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Z=(e,t,r)=>{let a=-1;const s=Y(t)?[t]:G(t),n=s.length,i=n-1;for(;++a<n;){const t=s[a];let n=r;if(a!==i){const r=e[t];n=P(r)||Array.isArray(r)?r:isNaN(+s[a+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=n,e=e[t]}return e};const z="blur",K="focusout",J="change",Q="onBlur",X="onChange",ee="onSubmit",te="onTouched",re="all",ae="max",se="min",ne="maxLength",ie="minLength",oe="pattern",le="required",de="validate",ce=F.createContext(null),ue=()=>F.useContext(ce);var me=(e,t,r,a=!0)=>{const s={defaultValues:t._defaultValues};for(const n in e)Object.defineProperty(s,n,{get:()=>{const s=n;return t._proxyFormState[s]!==re&&(t._proxyFormState[s]=!a||re),r&&(r[s]=!0),e[s]}});return s},he=e=>P(e)&&!Object.keys(e).length,fe=(e,t,r,a)=>{r(e);const s=e,{name:n}=s,i=d(s,["name"]);return he(i)||Object.keys(i).length>=Object.keys(t).length||Object.keys(i).find((e=>t[e]===(!a||re)))},ge=e=>Array.isArray(e)?e:[e],be=(e,t,r)=>!e||!t||e===t||ge(e).some((e=>e&&(r?e===t:e.startsWith(t)||t.startsWith(e))));function pe(e){const t=F.useRef(e);t.current=e,F.useEffect((()=>{const r=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{r&&r.unsubscribe()}}),[e.disabled])}var xe=e=>"string"==typeof e,ve=(e,t,r,a,s)=>xe(e)?(a&&t.watch.add(e),H(r,e,s)):Array.isArray(e)?e.map((e=>(a&&t.watch.add(e),H(r,e)))):(a&&(t.watchAll=!0),r);function ye(e){const t=ue(),{name:r,disabled:a,control:s=t.control,shouldUnregister:n}=e,i=$(s._names.array,r),d=function(e){const t=ue(),{control:r=t.control,name:a,defaultValue:s,disabled:n,exact:i}=e||{},o=F.useRef(a);o.current=a,pe({disabled:n,subject:r._subjects.values,next:e=>{be(o.current,e.name,i)&&d(I(ve(o.current,r._names,e.values||r._formValues,!1,s)))}});const[l,d]=F.useState(r._getWatch(a,s));return F.useEffect((()=>r._removeUnmounted())),l}({control:s,name:r,defaultValue:H(s._formValues,r,H(s._defaultValues,r,e.defaultValue)),exact:!0}),c=function(e){const t=ue(),{control:r=t.control,disabled:a,name:s,exact:n}=e||{},[i,l]=F.useState(r._formState),d=F.useRef(!0),c=F.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),u=F.useRef(s);return u.current=s,pe({disabled:a,next:e=>d.current&&be(u.current,e.name,n)&&fe(e,c.current,r._updateFormState)&&l(o(o({},r._formState),e)),subject:r._subjects.state}),F.useEffect((()=>(d.current=!0,c.current.isValid&&r._updateValid(!0),()=>{d.current=!1})),[r]),F.useMemo((()=>me(i,r,c.current,!1)),[i,r])}({control:s,name:r,exact:!0}),u=F.useRef(s.register(r,o(l(o({},e.rules),{value:d}),W(e.disabled)?{disabled:e.disabled}:{}))),m=F.useMemo((()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!H(c.errors,r)},isDirty:{enumerable:!0,get:()=>!!H(c.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!H(c.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!H(c.validatingFields,r)},error:{enumerable:!0,get:()=>H(c.errors,r)}})),[c,r]),h=F.useMemo((()=>l(o({name:r,value:d},W(a)||c.disabled?{disabled:c.disabled||a}:{}),{onChange:e=>u.current.onChange({target:{value:M(e),name:r},type:J}),onBlur:()=>u.current.onBlur({target:{value:H(s._formValues,r),name:r},type:z}),ref:e=>{const t=H(s._fields,r);t&&e&&(t._f.ref={focus:()=>e.focus(),select:()=>e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})}})),[r,s._formValues,a,c.disabled,d,s._fields]);return F.useEffect((()=>{const e=s._options.shouldUnregister||n,t=(e,t)=>{const r=H(s._fields,e);r&&r._f&&(r._f.mount=t)};if(t(r,!0),e){const e=I(H(s._options.defaultValues,r));Z(s._defaultValues,r,e),R(H(s._formValues,r))&&Z(s._formValues,r,e)}return()=>{(i?e&&!s._state.action:e)?s.unregister(r):t(r,!1)}}),[r,s,i,n]),F.useEffect((()=>{W(a)&&H(s._fields,r)&&s._updateDisabledField({disabled:a,fields:s._fields,name:r,value:H(s._fields,r)._f.value})}),[a,r,s]),F.useMemo((()=>({field:h,formState:c,fieldState:m})),[h,c,m])}const ke=e=>e.render(ye(e));var je=(e,t,r,a,s)=>t?l(o({},r[e]),{types:l(o({},r[e]&&r[e].types?r[e].types:{}),{[a]:s||!0})}):{},we=e=>({isOnSubmit:!e||e===ee,isOnBlur:e===Q,isOnChange:e===X,isOnAll:e===re,isOnTouch:e===te}),Ne=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some((t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length)))));const Se=(e,t,r,a)=>{for(const s of r||Object.keys(e)){const r=H(e,s);if(r){const e=r,{_f:n}=e,i=d(e,["_f"]);if(n){if(n.refs&&n.refs[0]&&t(n.refs[0],s)&&!a)return!0;if(n.ref&&t(n.ref,n.name)&&!a)return!0;if(Se(i,t))break}else if(P(i)&&Se(i,t))break}}};var Ae=(e,t,r)=>{const a=ge(H(e,r));return Z(a,"root",t[r]),Z(e,r,a),e},Fe=e=>"file"===e.type,_e=e=>"function"==typeof e,De=e=>{if(!B)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Te=e=>xe(e),Ve=e=>"radio"===e.type,Ee=e=>e instanceof RegExp;const Ce={value:!1,isValid:!1},Le={value:!0,isValid:!0};var Ue=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter((e=>e&&e.checked&&!e.disabled)).map((e=>e.value));return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!R(e[0].attributes.value)?R(e[0].value)||""===e[0].value?Le:{value:e[0].value,isValid:!0}:Le:Ce}return Ce};const Oe={isValid:!1,value:null};var Pe=e=>Array.isArray(e)?e.reduce(((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e),Oe):Oe;function Me(e,t,r="validate"){if(Te(e)||Array.isArray(e)&&e.every(Te)||W(e)&&!e)return{type:r,message:Te(e)?e:"",ref:t}}var $e=e=>P(e)&&!Ee(e)?e:{value:e,message:""},Be=(e,t,r,a,s)=>c(void 0,null,(function*(){const{ref:n,refs:i,required:l,maxLength:d,minLength:c,min:u,max:m,pattern:h,validate:f,name:g,valueAsNumber:b,mount:p,disabled:x}=e._f,v=H(t,g);if(!p||x)return{};const y=i?i[0]:n,k=e=>{a&&y.reportValidity&&(y.setCustomValidity(W(e)?"":e||""),y.reportValidity())},j={},w=Ve(n),N=C(n),S=w||N,A=(b||Fe(n))&&R(n.value)&&R(v)||De(n)&&""===n.value||""===v||Array.isArray(v)&&!v.length,F=je.bind(null,g,r,j),_=(e,t,r,a=ne,s=ie)=>{const i=e?t:r;j[g]=o({type:e?a:s,message:i,ref:n},F(e?a:s,i))};if(s?!Array.isArray(v)||!v.length:l&&(!S&&(A||U(v))||W(v)&&!v||N&&!Ue(i).isValid||w&&!Pe(i).isValid)){const{value:e,message:t}=Te(l)?{value:!!l,message:l}:$e(l);if(e&&(j[g]=o({type:le,message:t,ref:y},F(le,t)),!r))return k(t),j}if(!(A||U(u)&&U(m))){let e,t;const a=$e(m),s=$e(u);if(U(v)||isNaN(v)){const r=n.valueAsDate||new Date(v),i=e=>new Date((new Date).toDateString()+" "+e),o="time"==n.type,l="week"==n.type;xe(a.value)&&v&&(e=o?i(v)>i(a.value):l?v>a.value:r>new Date(a.value)),xe(s.value)&&v&&(t=o?i(v)<i(s.value):l?v<s.value:r<new Date(s.value))}else{const r=n.valueAsNumber||(v?+v:v);U(a.value)||(e=r>a.value),U(s.value)||(t=r<s.value)}if((e||t)&&(_(!!e,a.message,s.message,ae,se),!r))return k(j[g].message),j}if((d||c)&&!A&&(xe(v)||s&&Array.isArray(v))){const e=$e(d),t=$e(c),a=!U(e.value)&&v.length>+e.value,s=!U(t.value)&&v.length<+t.value;if((a||s)&&(_(a,e.message,t.message),!r))return k(j[g].message),j}if(h&&!A&&xe(v)){const{value:e,message:t}=$e(h);if(Ee(e)&&!v.match(e)&&(j[g]=o({type:oe,message:t,ref:n},F(oe,t)),!r))return k(t),j}if(f)if(_e(f)){const e=Me(yield f(v,t),y);if(e&&(j[g]=o(o({},e),F(de,e.message)),!r))return k(e.message),j}else if(P(f)){let e={};for(const a in f){if(!he(e)&&!r)break;const s=Me(yield f[a](v,t),y,a);s&&(e=o(o({},s),F(a,s.message)),k(s.message),r&&(j[g]=e))}if(!he(e)&&(j[g]=o({ref:y},e),!r))return j}return k(!0),j}));function Ie(e,t){const r=Array.isArray(t)?t:Y(t)?[t]:G(t),a=1===r.length?e:function(e,t){const r=t.slice(0,-1).length;let a=0;for(;a<r;)e=R(e)?a++:e[t[a++]];return e}(e,r),s=r.length-1,n=r[s];return a&&delete a[n],0!==s&&(P(a)&&he(a)||Array.isArray(a)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!R(e[t]))return!1;return!0}(a))&&Ie(e,r.slice(0,-1)),e}var qe=()=>{let e=[];return{get observers(){return e},next:t=>{for(const r of e)r.next&&r.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter((e=>e!==t))}}),unsubscribe:()=>{e=[]}}},Re=e=>U(e)||!O(e);function He(e,t){if(Re(e)||Re(t))return e===t;if(L(e)&&L(t))return e.getTime()===t.getTime();const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const s of r){const r=e[s];if(!a.includes(s))return!1;if("ref"!==s){const e=t[s];if(L(r)&&L(e)||P(r)&&P(e)||Array.isArray(r)&&Array.isArray(e)?!He(r,e):r!==e)return!1}}return!0}var We=e=>"select-multiple"===e.type,Ye=e=>De(e)&&e.isConnected,Ge=e=>{for(const t in e)if(_e(e[t]))return!0;return!1};function Ze(e,t={}){const r=Array.isArray(e);if(P(e)||r)for(const a in e)Array.isArray(e[a])||P(e[a])&&!Ge(e[a])?(t[a]=Array.isArray(e[a])?[]:{},Ze(e[a],t[a])):U(e[a])||(t[a]=!0);return t}function ze(e,t,r){const a=Array.isArray(e);if(P(e)||a)for(const s in e)Array.isArray(e[s])||P(e[s])&&!Ge(e[s])?R(t)||Re(r[s])?r[s]=Array.isArray(e[s])?Ze(e[s],[]):o({},Ze(e[s])):ze(e[s],U(t)?{}:t[s],r[s]):r[s]=!He(e[s],t[s]);return r}var Ke=(e,t)=>ze(e,t,Ze(t)),Je=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:a})=>R(e)?e:t?""===e?NaN:e?+e:e:r&&xe(e)?new Date(e):a?a(e):e;function Qe(e){const t=e.ref;if(!(e.refs?e.refs.every((e=>e.disabled)):t.disabled))return Fe(t)?t.files:Ve(t)?Pe(e.refs).value:We(t)?[...t.selectedOptions].map((({value:e})=>e)):C(t)?Ue(e.refs).value:Je(R(t.value)?e.ref.value:t.value,e)}var Xe=e=>R(e)?e:Ee(e)?e.source:P(e)?Ee(e.value)?e.value.source:e.value:e;const et="AsyncFunction";function tt(e,t,r){const a=H(e,r);if(a||Y(r))return{error:a,name:r};const s=r.split(".");for(;s.length;){const a=s.join("."),n=H(t,a),i=H(e,a);if(n&&!Array.isArray(n)&&r!==a)return{name:r};if(i&&i.type)return{name:a,error:i};s.pop()}return{name:r}}const rt={mode:ee,reValidateMode:X,shouldFocusError:!0};function at(e={}){let t,r=o(o({},rt),e),a={submitCount:0,isDirty:!1,isLoading:_e(r.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1},s={},n=(P(r.defaultValues)||P(r.values))&&I(r.defaultValues||r.values)||{},i=r.shouldUnregister?{}:I(n),u={action:!1,mount:!1,watch:!1},m={mount:new Set,unMount:new Set,array:new Set,watch:new Set},h=0;const f={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},g={values:qe(),array:qe(),state:qe()},b=we(r.mode),p=we(r.reValidateMode),x=r.criteriaMode===re,v=e=>c(this,null,(function*(){if(!r.disabled&&(f.isValid||e)){const e=r.resolver?he((yield N()).errors):yield A(s,!0);e!==a.isValid&&g.state.next({isValid:e})}})),y=(e,t)=>{r.disabled||!f.isValidating&&!f.validatingFields||((e||Array.from(m.mount)).forEach((e=>{e&&(t?Z(a.validatingFields,e,t):Ie(a.validatingFields,e))})),g.state.next({validatingFields:a.validatingFields,isValidating:!he(a.validatingFields)}))},k=(e,t,r,a)=>{const o=H(s,e);if(o){const s=H(i,e,R(r)?H(n,e):r);R(s)||a&&a.defaultChecked||t?Z(i,e,t?s:Qe(o._f)):D(e,s),u.mount&&v()}},j=(e,t,i,o,l)=>{let d=!1,c=!1;const u={name:e};if(!r.disabled){const r=!!(H(s,e)&&H(s,e)._f&&H(s,e)._f.disabled);if(!i||o){f.isDirty&&(c=a.isDirty,a.isDirty=u.isDirty=F(),d=c!==u.isDirty);const s=r||He(H(n,e),t);c=!(r||!H(a.dirtyFields,e)),s||r?Ie(a.dirtyFields,e):Z(a.dirtyFields,e,!0),u.dirtyFields=a.dirtyFields,d=d||f.dirtyFields&&c!==!s}if(i){const t=H(a.touchedFields,e);t||(Z(a.touchedFields,e,i),u.touchedFields=a.touchedFields,d=d||f.touchedFields&&t!==i)}d&&l&&g.state.next(u)}return d?u:{}},w=(e,s,n,i)=>{const d=H(a.errors,e),c=f.isValid&&W(s)&&a.isValid!==s;var u;if(r.delayError&&n?(u=()=>((e,t)=>{Z(a.errors,e,t),g.state.next({errors:a.errors})})(e,n),t=e=>{clearTimeout(h),h=setTimeout(u,e)},t(r.delayError)):(clearTimeout(h),t=null,n?Z(a.errors,e,n):Ie(a.errors,e)),(n?!He(d,n):d)||!he(i)||c){const t=l(o(o({},i),c&&W(s)?{isValid:s}:{}),{errors:a.errors,name:e});a=o(o({},a),t),g.state.next(t)}},N=e=>c(this,null,(function*(){y(e,!0);const t=yield r.resolver(i,r.context,((e,t,r,a)=>{const s={};for(const n of e){const e=H(t,n);e&&Z(s,n,e._f)}return{criteriaMode:r,names:[...e],fields:s,shouldUseNativeValidation:a}})(e||m.mount,s,r.criteriaMode,r.shouldUseNativeValidation));return y(e),t})),S=e=>c(this,null,(function*(){const{errors:t}=yield N(e);if(e)for(const r of e){const e=H(t,r);e?Z(a.errors,r,e):Ie(a.errors,r)}else a.errors=t;return t})),A=(e,t,...s)=>c(this,[e,t,...s],(function*(e,t,s={valid:!0}){for(const o in e){const l=e[o];if(l){const e=l,{_f:c}=e,u=d(e,["_f"]);if(c){const e=m.array.has(c.name),d=l._f&&(!!(n=l._f)&&!!n.validate&&!!(_e(n.validate)&&n.validate.constructor.name===et||P(n.validate)&&Object.values(n.validate).find((e=>e.constructor.name===et))));d&&f.validatingFields&&y([o],!0);const u=yield Be(l,i,x,r.shouldUseNativeValidation&&!t,e);if(d&&f.validatingFields&&y([o]),u[c.name]&&(s.valid=!1,t))break;!t&&(H(u,c.name)?e?Ae(a.errors,u,c.name):Z(a.errors,c.name,u[c.name]):Ie(a.errors,c.name))}!he(u)&&(yield A(u,t,s))}}var n;return s.valid})),F=(e,t)=>!r.disabled&&(e&&t&&Z(i,e,t),!He(G(),n)),_=(e,t,r)=>ve(e,m,o({},u.mount?i:R(t)?n:xe(e)?{[e]:t}:t),r,t),D=(e,t,r={})=>{const a=H(s,e);let n=t;if(a){const r=a._f;r&&(!r.disabled&&Z(i,e,Je(t,r)),n=De(r.ref)&&U(t)?"":t,We(r.ref)?[...r.ref.options].forEach((e=>e.selected=n.includes(e.value))):r.refs?C(r.ref)?r.refs.length>1?r.refs.forEach((e=>(!e.defaultChecked||!e.disabled)&&(e.checked=Array.isArray(n)?!!n.find((t=>t===e.value)):n===e.value))):r.refs[0]&&(r.refs[0].checked=!!n):r.refs.forEach((e=>e.checked=e.value===n)):Fe(r.ref)?r.ref.value="":(r.ref.value=n,r.ref.type||g.values.next({name:e,values:o({},i)})))}(r.shouldDirty||r.shouldTouch)&&j(e,n,r.shouldTouch,r.shouldDirty,!0),r.shouldValidate&&Y(e)},T=(e,t,r)=>{for(const a in t){const n=t[a],i=`${e}.${a}`,o=H(s,i);(m.array.has(e)||P(n)||o&&!o._f)&&!L(n)?T(i,n,r):D(i,n,r)}},V=(e,t,r={})=>{const l=H(s,e),d=m.array.has(e),c=I(t);Z(i,e,c),d?(g.array.next({name:e,values:o({},i)}),(f.isDirty||f.dirtyFields)&&r.shouldDirty&&g.state.next({name:e,dirtyFields:Ke(n,i),isDirty:F(e,c)})):!l||l._f||U(c)?D(e,c,r):T(e,c,r),Ne(e,m)&&g.state.next(o({},a)),g.values.next({name:u.mount?e:void 0,values:o({},i)})},E=e=>c(this,null,(function*(){u.mount=!0;const n=e.target;let l=n.name,d=!0;const c=H(s,l),h=e=>{d=Number.isNaN(e)||L(e)&&isNaN(e.getTime())||He(e,H(i,l,e))};if(c){let u,S;const F=n.type?Qe(c._f):M(e),_=e.type===z||e.type===K,D=!((k=c._f).mount&&(k.required||k.min||k.max||k.maxLength||k.minLength||k.pattern||k.validate)||r.resolver||H(a.errors,l)||c._f.deps)||((e,t,r,a,s)=>!s.isOnAll&&(!r&&s.isOnTouch?!(t||e):(r?a.isOnBlur:s.isOnBlur)?!e:!(r?a.isOnChange:s.isOnChange)||e))(_,H(a.touchedFields,l),a.isSubmitted,p,b),T=Ne(l,m,_);Z(i,l,F),_?(c._f.onBlur&&c._f.onBlur(e),t&&t(0)):c._f.onChange&&c._f.onChange(e);const V=j(l,F,_,!1),E=!he(V)||T;if(!_&&g.values.next({name:l,type:e.type,values:o({},i)}),D)return f.isValid&&("onBlur"===r.mode?_&&v():v()),E&&g.state.next(o({name:l},T?{}:V));if(!_&&T&&g.state.next(o({},a)),r.resolver){const{errors:e}=yield N([l]);if(h(F),d){const t=tt(a.errors,s,l),r=tt(e,s,t.name||l);u=r.error,l=r.name,S=he(e)}}else y([l],!0),u=(yield Be(c,i,x,r.shouldUseNativeValidation))[l],y([l]),h(F),d&&(u?S=!1:f.isValid&&(S=yield A(s,!0)));d&&(c._f.deps&&Y(c._f.deps),w(l,S,u,V))}var k})),O=(e,t)=>{if(H(a.errors,t)&&e.focus)return e.focus(),1},Y=(e,...t)=>c(this,[e,...t],(function*(e,t={}){let n,i;const d=ge(e);if(r.resolver){const t=yield S(R(e)?e:d);n=he(t),i=e?!d.some((e=>H(t,e))):n}else e?(i=(yield Promise.all(d.map((e=>c(this,null,(function*(){const t=H(s,e);return yield A(t&&t._f?{[e]:t}:t)})))))).every(Boolean),(i||a.isValid)&&v()):i=n=yield A(s);return g.state.next(l(o(o({},!xe(e)||f.isValid&&n!==a.isValid?{}:{name:e}),r.resolver||!e?{isValid:n}:{}),{errors:a.errors})),t.shouldFocus&&!i&&Se(s,O,e?d:m.mount),i})),G=e=>{const t=o({},u.mount?i:n);return R(e)?t:xe(e)?H(t,e):e.map((e=>H(t,e)))},J=(e,t)=>({invalid:!!H((t||a).errors,e),isDirty:!!H((t||a).dirtyFields,e),error:H((t||a).errors,e),isValidating:!!H(a.validatingFields,e),isTouched:!!H((t||a).touchedFields,e)}),Q=(e,t,r)=>{const n=(H(s,e,{_f:{}})._f||{}).ref,i=H(a.errors,e)||{},{ref:c,message:u,type:m}=i,h=d(i,["ref","message","type"]);Z(a.errors,e,l(o(o({},h),t),{ref:n})),g.state.next({name:e,errors:a.errors,isValid:!1}),r&&r.shouldFocus&&n&&n.focus&&n.focus()},X=(e,t={})=>{for(const o of e?ge(e):m.mount)m.mount.delete(o),m.array.delete(o),t.keepValue||(Ie(s,o),Ie(i,o)),!t.keepError&&Ie(a.errors,o),!t.keepDirty&&Ie(a.dirtyFields,o),!t.keepTouched&&Ie(a.touchedFields,o),!t.keepIsValidating&&Ie(a.validatingFields,o),!r.shouldUnregister&&!t.keepDefaultValue&&Ie(n,o);g.values.next({values:o({},i)}),g.state.next(o(o({},a),t.keepDirty?{isDirty:F()}:{})),!t.keepIsValid&&v()},ee=({disabled:e,name:t,field:r,fields:a,value:s})=>{if(W(e)&&u.mount||e){const n=e?void 0:R(s)?Qe(r?r._f:H(a,t)._f):s;(e||!e&&!R(n))&&Z(i,t,n),j(t,n,!1,!1,!0)}},te=(e,t={})=>{let a=H(s,e);const i=W(t.disabled)||W(r.disabled);return Z(s,e,l(o({},a||{}),{_f:o(l(o({},a&&a._f?a._f:{ref:{name:e}}),{name:e,mount:!0}),t)})),m.mount.add(e),a?ee({field:a,disabled:W(t.disabled)?t.disabled:r.disabled,name:e,value:t.value}):k(e,!0,t.value),l(o(o({},i?{disabled:t.disabled||r.disabled}:{}),r.progressive?{required:!!t.required,min:Xe(t.min),max:Xe(t.max),minLength:Xe(t.minLength),maxLength:Xe(t.maxLength),pattern:Xe(t.pattern)}:{}),{name:e,onChange:E,onBlur:E,ref:i=>{if(i){te(e,t),a=H(s,e);const r=R(i.value)&&i.querySelectorAll&&i.querySelectorAll("input,select,textarea")[0]||i,l=(e=>Ve(e)||C(e))(r),d=a._f.refs||[];if(l?d.find((e=>e===r)):r===a._f.ref)return;Z(s,e,{_f:o(o({},a._f),l?{refs:[...d.filter(Ye),r,...Array.isArray(H(n,e))?[{}]:[]],ref:{type:r.type,name:e}}:{ref:r})}),k(e,!1,void 0,r)}else a=H(s,e,{}),a._f&&(a._f.mount=!1),(r.shouldUnregister||t.shouldUnregister)&&(!$(m.array,e)||!u.action)&&m.unMount.add(e)}})},ae=()=>r.shouldFocusError&&Se(s,O,m.mount),se=(e,t)=>n=>c(this,null,(function*(){let l;if(n&&(n.preventDefault&&n.preventDefault(),n.persist&&n.persist()),r.disabled)return void(t&&(yield t(o({},a.errors),n)));let d=I(i);if(g.state.next({isSubmitting:!0}),r.resolver){const{errors:e,values:t}=yield N();a.errors=e,d=t}else yield A(s);if(Ie(a.errors,"root"),he(a.errors)){g.state.next({errors:{}});try{yield e(d,n)}catch(c){l=c}}else t&&(yield t(o({},a.errors),n)),ae(),setTimeout(ae);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:he(a.errors)&&!l,submitCount:a.submitCount+1,errors:a.errors}),l)throw l})),ne=(e,t={})=>{const l=e?I(e):n,d=I(l),c=he(e),h=c?n:d;if(t.keepDefaultValues||(n=l),!t.keepValues){if(t.keepDirtyValues){const e=new Set([...m.mount,...Object.keys(Ke(n,i))]);for(const t of Array.from(e))H(a.dirtyFields,t)?Z(h,t,H(i,t)):V(t,H(h,t))}else{if(B&&R(e))for(const e of m.mount){const t=H(s,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(De(e)){const t=e.closest("form");if(t){t.reset();break}}}}s={}}i=r.shouldUnregister?t.keepDefaultValues?I(n):{}:I(h),g.array.next({values:o({},h)}),g.values.next({values:o({},h)})}m={mount:t.keepDirtyValues?m.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},u.mount=!f.isValid||!!t.keepIsValid||!!t.keepDirtyValues,u.watch=!!r.shouldUnregister,g.state.next({submitCount:t.keepSubmitCount?a.submitCount:0,isDirty:!c&&(t.keepDirty?a.isDirty:!(!t.keepDefaultValues||He(e,n))),isSubmitted:!!t.keepIsSubmitted&&a.isSubmitted,dirtyFields:c?{}:t.keepDirtyValues?t.keepDefaultValues&&i?Ke(n,i):a.dirtyFields:t.keepDefaultValues&&e?Ke(n,e):t.keepDirty?a.dirtyFields:{},touchedFields:t.keepTouched?a.touchedFields:{},errors:t.keepErrors?a.errors:{},isSubmitSuccessful:!!t.keepIsSubmitSuccessful&&a.isSubmitSuccessful,isSubmitting:!1})},ie=(e,t)=>ne(_e(e)?e(i):e,t);return{control:{register:te,unregister:X,getFieldState:J,handleSubmit:se,setError:Q,_executeSchema:N,_getWatch:_,_getDirty:F,_updateValid:v,_removeUnmounted:()=>{for(const e of m.unMount){const t=H(s,e);t&&(t._f.refs?t._f.refs.every((e=>!Ye(e))):!Ye(t._f.ref))&&X(e)}m.unMount=new Set},_updateFieldArray:(e,t=[],o,l,d=!0,c=!0)=>{if(l&&o&&!r.disabled){if(u.action=!0,c&&Array.isArray(H(s,e))){const t=o(H(s,e),l.argA,l.argB);d&&Z(s,e,t)}if(c&&Array.isArray(H(a.errors,e))){const t=o(H(a.errors,e),l.argA,l.argB);d&&Z(a.errors,e,t),((e,t)=>{!q(H(e,t)).length&&Ie(e,t)})(a.errors,e)}if(f.touchedFields&&c&&Array.isArray(H(a.touchedFields,e))){const t=o(H(a.touchedFields,e),l.argA,l.argB);d&&Z(a.touchedFields,e,t)}f.dirtyFields&&(a.dirtyFields=Ke(n,i)),g.state.next({name:e,isDirty:F(e,t),dirtyFields:a.dirtyFields,errors:a.errors,isValid:a.isValid})}else Z(i,e,t)},_updateDisabledField:ee,_getFieldArray:e=>q(H(u.mount?i:n,e,r.shouldUnregister?H(n,e,[]):[])),_reset:ne,_resetDefaultValues:()=>_e(r.defaultValues)&&r.defaultValues().then((e=>{ie(e,r.resetOptions),g.state.next({isLoading:!1})})),_updateFormState:e=>{a=o(o({},a),e)},_disableForm:e=>{W(e)&&(g.state.next({disabled:e}),Se(s,((t,r)=>{const a=H(s,r);a&&(t.disabled=a._f.disabled||e,Array.isArray(a._f.refs)&&a._f.refs.forEach((t=>{t.disabled=a._f.disabled||e})))}),0,!1))},_subjects:g,_proxyFormState:f,_setErrors:e=>{a.errors=e,g.state.next({errors:a.errors,isValid:!1})},get _fields(){return s},get _formValues(){return i},get _state(){return u},set _state(e){u=e},get _defaultValues(){return n},get _names(){return m},set _names(e){m=e},get _formState(){return a},set _formState(e){a=e},get _options(){return r},set _options(e){r=o(o({},r),e)}},trigger:Y,register:te,handleSubmit:se,watch:(e,t)=>_e(e)?g.values.subscribe({next:r=>e(_(void 0,t),r)}):_(e,t,!0),setValue:V,getValues:G,reset:ie,resetField:(e,t={})=>{H(s,e)&&(R(t.defaultValue)?V(e,I(H(n,e))):(V(e,t.defaultValue),Z(n,e,I(t.defaultValue))),t.keepTouched||Ie(a.touchedFields,e),t.keepDirty||(Ie(a.dirtyFields,e),a.isDirty=t.defaultValue?F(e,I(H(n,e))):F()),t.keepError||(Ie(a.errors,e),f.isValid&&v()),g.state.next(o({},a)))},clearErrors:e=>{e&&ge(e).forEach((e=>Ie(a.errors,e))),g.state.next({errors:e?a.errors:{}})},unregister:X,setError:Q,setFocus:(e,t={})=>{const r=H(s,e),a=r&&r._f;if(a){const e=a.refs?a.refs[0]:a.ref;e.focus&&(e.focus(),t.shouldSelect&&_e(e.select)&&e.select())}},getFieldState:J}}const st=e=>new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(e),nt=(e,t)=>`${new Intl.DateTimeFormat("en-US",{timeZone:"America/Los_Angeles",weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(e)}, ${t}`,it=({bookingDetails:e,onInputChange:t,captcha:r,onSubmit:a,isFormValid:s,onBack:n})=>{var i;const{control:d,handleSubmit:h,formState:{errors:f,isValid:g},watch:b,setValue:p,trigger:x,setError:v,clearErrors:y}=function(e={}){const t=F.useRef(void 0),r=F.useRef(void 0),[a,s]=F.useState({isDirty:!1,isValidating:!1,isLoading:_e(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:_e(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current=l(o({},at(e)),{formState:a}));const n=t.current.control;return n._options=e,pe({subject:n._subjects.state,next:e=>{fe(e,n._proxyFormState,n._updateFormState,!0)&&s(o({},n._formState))}}),F.useEffect((()=>n._disableForm(e.disabled)),[n,e.disabled]),F.useEffect((()=>{if(n._proxyFormState.isDirty){const e=n._getDirty();e!==a.isDirty&&n._subjects.state.next({isDirty:e})}}),[n,a.isDirty]),F.useEffect((()=>{e.values&&!He(e.values,r.current)?(n._reset(e.values,n._options.resetOptions),r.current=e.values,s((e=>o({},e)))):n._resetDefaultValues()}),[e.values,n]),F.useEffect((()=>{e.errors&&n._setErrors(e.errors)}),[e.errors,n]),F.useEffect((()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next(o({},n._formState))),n._removeUnmounted()})),F.useEffect((()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})}),[e.shouldUnregister,n]),t.current.formState=me(a,n),t.current}({mode:"onChange",defaultValues:{name:e.name||"",contact:e.contact||"",email:e.email||"",makeModel:e.makeModel||"",date:"",time:"",captchaAnswer:""}}),[k,j]=A.useState({}),[w,N]=A.useState(!1),S=b("date");b("time");const _=["9:00 AM","10:00 AM","11:00 AM","12:00 PM","1:00 PM","2:00 PM","3:00 PM","4:00 PM","5:00 PM"],T={name:{required:"Name is required",pattern:{value:/^[a-zA-Z\s]*$/,message:"Please enter a valid name (letters only)"},minLength:{value:2,message:"Name must be at least 2 characters long"}},contact:{required:"Phone number is required",pattern:{value:/^(\+?1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/,message:"Please enter a valid US phone number (e.g., 123-456-7890)"}},email:{required:"Email address is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Please enter a valid email address"}},makeModel:{required:"Car make and model is required",minLength:{value:3,message:"Car make and model must be at least 2 characters long"}},date:{required:"Please select a date"},time:{required:"Please select a time"},captchaAnswer:{required:"Please answer the CAPTCHA",validate:e=>e.trim()===r.answer||"Incorrect CAPTCHA answer"}},V=()=>{const e=[],t=new Date((new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}));for(let r=1;r<8;r++){const a=new Date(t);a.setDate(t.getDate()+r);const s=st(a),n=s;e.push({value:s,display:n})}return e},E=e=>c(void 0,null,(function*(){if(e){N(!0);try{const t=new Date(e),r=st(t),a=yield fetch(`${D.API_URL}/bookings/check-date-slots?date=${encodeURIComponent(r)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=yield a.json();j(s.slots)}catch(t){j({})}finally{N(!1)}}}));A.useEffect((()=>{S&&E(S)}),[S]);const C=`\n    w-full p-3 rounded-lg shadow-sm transition-colors duration-200\n    focus:outline-none focus:ring-2 focus:ring-primary-light dark:focus:ring-orange-500\n    bg-white dark:bg-stone-800 \n    text-content-DEFAULT dark:text-white \n    placeholder:text-content-light dark:placeholder:text-stone-400\n    hover:bg-gray-50 dark:hover:bg-stone-700/50\n    ${f?"border-red-500":"border-border-DEFAULT dark:border-stone-700"}\n  `;return u.jsx("div",{className:"relative",children:u.jsxs(m.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-content-dark dark:text-white",children:"Booking Details"}),u.jsxs("form",{onSubmit:h((e=>c(void 0,null,(function*(){try{if(!(yield x()))return;const n=new Date(e.date),i=nt(n,e.time),d=yield(r=e.date,s=e.time,c(void 0,null,(function*(){if(!r||!s)return!1;const e=new Date(r),a=nt(e,s);try{const e=yield fetch(`${D.API_URL}/bookings/check-slot?dateTime=${encodeURIComponent(a)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=yield e.json();return r.success&&r.available?(t({target:{name:"dateTime",value:a}}),!0):(p("time",""),!1)}catch(n){return p("time",""),!1}})));if(!d)return void v("time",{type:"manual",message:"This time slot is no longer available"});const u=l(o({},e),{dateTime:i}),m=yield a(u);if(!(null==m?void 0:m.success))throw new Error((null==m?void 0:m.error)||"Failed to create booking")}catch(n){v("root.serverError",{type:"manual",message:n.message||"Failed to create booking"})}var r,s})))),className:"space-y-4",noValidate:!0,children:[(null==(i=f.root)?void 0:i.serverError)&&u.jsx("div",{className:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800",role:"alert",children:f.root.serverError.message}),u.jsxs("div",{className:"space-y-1",children:[u.jsx(ke,{name:"name",control:d,rules:T.name,render:({field:e})=>u.jsx("input",l(o({},e),{type:"text",placeholder:"Your Name",className:C,"aria-describedby":"nameError"}))}),f.name&&u.jsx("span",{className:"text-red-500 text-sm",id:"nameError",children:f.name.message})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx(ke,{name:"contact",control:d,rules:T.contact,render:({field:e})=>u.jsx("input",l(o({},e),{type:"tel",placeholder:"Contact Number (e.g., 123-456-7890)",className:C,"aria-describedby":"contactError"}))}),f.contact&&u.jsx("span",{className:"text-red-500 text-sm",id:"contactError",children:f.contact.message})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx(ke,{name:"email",control:d,rules:T.email,render:({field:e})=>u.jsx("input",l(o({},e),{type:"email",placeholder:"Email Address",className:C,"aria-describedby":"emailError"}))}),f.email&&u.jsx("span",{className:"text-red-500 text-sm",id:"emailError",children:f.email.message})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx(ke,{name:"makeModel",control:d,rules:T.makeModel,render:({field:e})=>u.jsx("input",l(o({},e),{type:"text",placeholder:"Car Make and Model",className:C,"aria-describedby":"makeModelError"}))}),f.makeModel&&u.jsx("span",{className:"text-red-500 text-sm",id:"makeModelError",children:f.makeModel.message})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("div",{className:"relative flex-1 space-y-1",children:[u.jsx(ke,{name:"date",control:d,rules:T.date,render:({field:e})=>u.jsxs("select",l(o({},e),{className:C,onChange:t=>{e.onChange(t),t.target.value&&E(t.target.value)},children:[u.jsx("option",{value:"",children:"Select Date"}),V().map((e=>u.jsx("option",{value:e.value,children:e.display},e.value)))]}))}),f.date&&u.jsx("span",{className:"text-red-500 text-sm",id:"dateError",children:f.date.message})]}),u.jsxs("div",{className:"relative flex-1 space-y-1",children:[u.jsx(ke,{name:"time",control:d,rules:T.time,render:({field:e})=>u.jsxs("div",{children:[u.jsxs("select",l(o({},e),{className:`${C} ${S?"":"cursor-not-allowed opacity-50"}`,disabled:!S||w,children:[u.jsx("option",{value:"",children:w?"Checking availability...":S?"Select Time":"Select date first"}),_.map((e=>{const t=k[e],r=null==t?void 0:t.available,a=t?"slots taken":"";return u.jsxs("option",{value:e,disabled:!r,children:[e," ",r?"":a]},e)}))]})),w&&u.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-light border-t-transparent"})})]})}),f.time&&u.jsx("span",{className:"text-red-500 text-sm",id:"timeError",children:f.time.message})]})]}),u.jsxs("div",{className:"p-4 rounded-lg border-2 border-border-DEFAULT dark:border-stone-700 bg-background-DEFAULT dark:bg-stone-800",children:[u.jsx("label",{className:"block mb-2 font-medium text-content-dark dark:text-white",children:r.question}),u.jsx(ke,{name:"captchaAnswer",control:d,rules:T.captchaAnswer,render:({field:e})=>u.jsx("input",l(o({},e),{type:"text",placeholder:"Enter CAPTCHA answer",className:C,"aria-describedby":"captchaError"}))}),f.captchaAnswer&&u.jsx("span",{className:"text-red-500 text-sm",id:"captchaError",children:f.captchaAnswer.message})]}),u.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:u.jsxs("div",{className:"max-w-[1000px] mx-auto space-y-3",children:[u.jsx(m.button,{type:"submit",disabled:!g,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(g?"bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600":"bg-background-dark dark:bg-stone-800 text-content-light dark:text-stone-500 cursor-not-allowed"),whileHover:g?{scale:1.02}:{},whileTap:g?{scale:.98}:{},children:"Complete Booking"}),u.jsx(m.button,{type:"button",onClick:n,className:"w-full p-3 rounded-lg bg-background-DEFAULT dark:bg-stone-800 text-content-DEFAULT dark:text-white border border-border-DEFAULT dark:border-stone-700 hover:bg-background-dark dark:hover:bg-stone-700 transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Addons"})]})})]})]})})},ot=({booking:e})=>e?u.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-2xl mx-auto",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("div",{className:"w-16 h-16 bg-primary-light dark:bg-orange-500 rounded-full mx-auto \n                  flex items-center justify-center mb-4",children:u.jsx(p,{className:"w-10 h-10 text-white"})}),u.jsx("h2",{className:"text-3xl font-bold mb-2 text-content-dark dark:text-white",children:"Booking Confirmed!"}),u.jsxs("p",{className:"text-lg text-content-light dark:text-stone-400",children:["Confirmation number:"," ",u.jsx("span",{className:"text-primary-DEFAULT dark:text-orange-500 font-mono font-bold",children:e.confirmationNumber})]})]}),u.jsxs("div",{className:"bg-background-DEFAULT dark:bg-stone-800 rounded-lg p-6 mb-8 \n                border border-border-light dark:border-stone-700 shadow-sm",children:[u.jsx("h3",{className:"text-2xl font-semibold mb-6 text-content-dark dark:text-white",children:"Booking Details"}),u.jsxs("div",{className:"space-y-6 text-left",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(x,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),u.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.name}),e.email&&u.jsx("span",{className:"text-sm text-content-light block",children:e.email})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(v,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),u.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.contact})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(y,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),u.jsxs("div",{children:[u.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.makeModel}),u.jsxs("span",{className:"text-sm text-content-light block",children:["Type: ",e.vehicleType]})]})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(k,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),u.jsx("span",{className:"text-content-DEFAULT dark:text-white",children:e.dateTime})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(j,{className:"w-5 h-5 text-primary-light dark:text-orange-500"}),u.jsxs("div",{children:[u.jsxs("p",{className:"font-medium text-content-DEFAULT",children:[e.serviceName," - $",e.servicePrice]}),u.jsxs("p",{className:"text-sm text-content-light mt-1",children:["Selected scent: ",e.selectedScent]})]})]}),e.optionalServices&&e.optionalServices.length>0&&u.jsxs("div",{className:"mt-4 pt-4 border-t border-border-light dark:border-stone-700",children:[u.jsx("h4",{className:"text-lg font-medium mb-2 text-content-dark dark:text-white",children:"Optional Services"}),e.optionalServices.map(((e,t)=>u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{className:"text-content-DEFAULT dark:text-stone-300",children:e.name}),u.jsxs("span",{className:"text-primary-DEFAULT dark:text-orange-500",children:["$",e.price]})]},t)))]}),u.jsx("div",{className:"mt-6 pt-6 border-t border-border-light dark:border-stone-700",children:u.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[u.jsx("span",{className:"text-content-dark dark:text-white",children:"Total Price:"}),u.jsxs("span",{className:"text-primary-DEFAULT dark:text-orange-500",children:["$",e.totalPrice]})]})})]})]}),u.jsxs("div",{className:"flex gap-4 mt-8",children:[e.email&&u.jsxs("button",{onClick:()=>c(void 0,null,(function*(){try{const t=yield fetch(`${D.API_URL}/bookings/${e.confirmationNumber}/resend-email`,{method:"POST",headers:{"Content-Type":"application/json"}}),r=yield t.json();if(!t.ok||!r.success)throw new Error(r.error||"Failed to send email");alert("Email sent successfully!")}catch(t){alert("Failed to send email. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 \n        bg-primary-light dark:bg-orange-500 text-white rounded-lg \n        hover:bg-primary-DEFAULT dark:hover:bg-orange-600 \n        transition-colors",children:[u.jsx(w,{className:"w-4 h-4"}),"Send Email"]}),u.jsxs("button",{onClick:()=>c(void 0,null,(function*(){try{const t=yield fetch(`${D.API_URL}${D.ENDPOINTS.BOOKINGS.PDF(e.confirmationNumber)}`,{headers:{Accept:"application/pdf"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=yield t.blob(),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`booking-${e.confirmationNumber}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(t){alert("Failed to download confirmation. Please try again.")}})),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors\n      "+(e.email?"bg-background-DEFAULT dark:bg-stone-800 text-content-DEFAULT dark:text-white border border-border-DEFAULT dark:border-stone-700 hover:bg-background-dark dark:hover:bg-stone-700":"bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600"),children:[u.jsx(N,{className:"w-4 h-4"}),"Download Confirmation"]})]}),u.jsxs("div",{className:"space-y-4 text-base mt-10",children:[u.jsxs("p",{className:"text-content-DEFAULT dark:text-stone-300",children:["Please save your confirmation number:"," ",u.jsx("span",{className:"font-mono font-bold text-primary-DEFAULT dark:text-orange-500",children:e.confirmationNumber})]}),u.jsx("p",{className:"text-content-DEFAULT dark:text-stone-300",children:"We look forward to servicing your vehicle at the scheduled time."}),u.jsx("p",{className:"text-content-DEFAULT dark:text-stone-300",children:"Please arrive 5-10 minutes before your appointment time."})]}),u.jsx(m.button,{onClick:()=>window.location.reload(),className:"mt-8 bg-background-DEFAULT border border-border-DEFAULT px-6 py-3 rounded-lg \n                 hover:bg-background-dark transition-colors text-content-DEFAULT",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Book Another Service"})]}):u.jsx("div",{className:"text-center py-8 text-red-500",children:"Booking information not available"}),lt=({selectedType:e,onTypeChange:t})=>{const{vehicleTypes:r,loading:a}=T();return a?u.jsx("div",{className:"flex justify-center items-center py-4",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):u.jsxs("div",{className:"relative mb-6",children:[u.jsx("label",{htmlFor:"vehicleType",className:"block text-sm font-medium text-content-dark dark:text-white mb-2",children:"Select Vehicle Type"}),u.jsxs("div",{className:"relative",children:[u.jsx("select",{id:"vehicleType",value:e,onChange:e=>t(e.target.value),className:"w-full p-3 pr-10 rounded-lg border-2 transition-colors duration-200\n            bg-background-light dark:bg-stone-800\n            border-border-DEFAULT dark:border-stone-700\n            text-content-DEFAULT dark:text-white\n            hover:border-border-dark dark:hover:border-stone-600\n            focus:outline-none focus:border-primary-light dark:focus:border-orange-500\n            appearance-none cursor-pointer",children:r.map((e=>u.jsx("option",{value:e.id,className:"bg-background-light dark:bg-stone-800",children:e.label},e.id)))}),u.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:u.jsx(g,{className:"h-5 w-5 text-content-light dark:text-stone-400"})})]})]})},dt=({selectedOptions:e,onOptionSelect:t,onContinue:r,onBack:a})=>{const{optionalServices:s,loading:n}=T();return n?u.jsx("div",{children:"Loading optional services..."}):u.jsxs("div",{className:"space-y-6",children:[u.jsx("div",{className:"space-y-4",children:s.map((r=>u.jsx(m.div,{className:"relative p-4 rounded-lg border-2 cursor-pointer transition-colors duration-200\n              "+(e.includes(r.id.toString())?"bg-primary-light/5 dark:bg-orange-500/10 border-primary-light dark:border-orange-500":"bg-white dark:bg-stone-800 border-primary-light/50 dark:border-orange-500/20 hover:border-primary-light/80 dark:hover:border-orange-500/40"),onClick:()=>{return a=r.id.toString(),void(e.includes(a)?t(e.filter((e=>e!==a))):t([...e,a]));var a},whileHover:{scale:1.01},whileTap:{scale:.99},children:u.jsxs("div",{className:"flex items-start justify-between gap-4",children:[u.jsxs("div",{className:"flex-grow",children:[u.jsx("h4",{className:"text-lg font-medium text-content-dark dark:text-white",children:r.name}),u.jsx("p",{className:"text-sm text-content-light dark:text-stone-400 mt-1",children:r.description})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("span",{className:"text-lg font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",r.price]}),u.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center\n                  "+(e.includes(r.id.toString())?"bg-primary-light dark:bg-orange-500":"border-2 border-primary-light/50 dark:border-orange-500/20"),children:e.includes(r.id.toString())?u.jsx(p,{className:"w-4 h-4 text-content-dark dark:text-white"}):u.jsx(S,{className:"w-4 h-4 text-content-light dark:text-stone-400"})})]})]})},r.id)))}),e.length>0&&u.jsx("div",{className:"py-3 border-t border-primary-light/30 dark:border-stone-700",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("p",{className:"text-sm text-content-light dark:text-stone-400",children:"Additional Services Total:"}),u.jsxs("p",{className:"text-xl font-bold text-primary-DEFAULT dark:text-orange-500",children:["$",s.filter((t=>e.includes(t.id.toString()))).reduce(((e,t)=>e+parseFloat(t.price)),0).toFixed(2)]})]})}),u.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 \n                bg-background-light/95 dark:bg-stone-900/95 \n                backdrop-blur-sm border-t border-primary-light/30 dark:border-stone-700",children:u.jsxs("div",{className:"space-y-3",children:[u.jsx(m.button,{onClick:r,className:"w-full p-3 rounded-lg bg-primary-light dark:bg-orange-500 \n            text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600 \n            transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Continue to Booking Details"}),u.jsx(m.button,{onClick:a,className:"w-full p-3 rounded-lg bg-background-DEFAULT dark:bg-stone-800 \n            text-content-DEFAULT dark:text-white \n            border border-primary-light/50 dark:border-stone-700 \n            hover:bg-background-dark dark:hover:bg-stone-700 \n            transition-colors duration-200",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Back to Services"})]})})]})},ct=()=>{const e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random()),r=["+","-","*"],a=r[Math.floor(Math.random()*r.length)];let s;switch(a){case"+":default:s=e+t;break;case"-":s=e-t;break;case"*":s=e*t}return{question:`What is ${e} ${a} ${t}?`,answer:s.toString()}},ut=()=>{const{bookingStep:e,selectedVehicleType:t,selectedService:r,selectedScent:a,selectedOptions:s,bookingDetails:n,booking:i,captcha:d,loading:h,error:f,optionalServicesData:g,handleVehicleTypeChange:p,handleNext:x,handleBack:v,setSelectedService:y,setSelectedScent:k,handleOptionSelect:j,handleInputChange:w,handleBookingSubmit:N,canProceedToDetails:S,isFormValid:F}=(()=>{var e;const{services:t}=V(),{vehicleTypes:r,scents:a,optionalServices:s}=T(),[n,i]=A.useState((null==(e=r[0])?void 0:e.id)||"sedan"),[d,u]=A.useState([]),[m,h]=A.useState("service"),[f,g]=A.useState(!1),[b,p]=A.useState(null),[x,v]=A.useState(null),[y,k]=A.useState({name:"",contact:"",email:"",makeModel:"",dateTime:""}),[j,w]=A.useState(null),[N,S]=A.useState(!1),[F,_]=A.useState(null),[E,C]=A.useState({question:"",answer:""});A.useEffect((()=>{C(ct())}),[]),A.useEffect((()=>{u([])}),[b,n]);const L=e=>{var t,r,a;const s={};return(null==(t=e.name)?void 0:t.trim())||(s.name="Name is required"),(null==(r=e.contact)?void 0:r.trim())?/^(\+?1)?[-.\s]?\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4}$/.test(e.contact)||(s.contact="Invalid phone number format"):s.contact="Contact number is required",e.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)&&(s.email="Invalid email format"),(null==(a=e.makeModel)?void 0:a.trim())||(s.makeModel="Make and model is required"),e.date&&e.time||(s.dateTime="Date and time are required"),s},U=b&&x,O=Object.values(y).every(Boolean)&&y.dateTime&&b&&n&&E.answer;return{bookingStep:m,selectedVehicleType:n,selectedService:b,selectedScent:x,selectedOptions:d,bookingDetails:y,captcha:E,booking:j,loading:N,error:F,optionalServices:s,vehicleTypes:r,scents:a,setSelectedService:p,setSelectedScent:v,setSelectedOptions:u,handleVehicleTypeChange:e=>{i(e),p(null),v(null)},handleBack:()=>{switch(m){case"options":h("service");break;case"details":h("options")}},handleOptionSelect:e=>{u(e)},handleNext:()=>{switch(m){case"service":U&&h("options");break;case"options":h("details")}},handleInputChange:e=>{const{name:t,value:r}=e.target;k((e=>l(o({},e),{[t]:r})))},handleBookingSubmit:e=>c(void 0,null,(function*(){var r;if(e.captchaAnswer!==E.answer)return C(ct()),_("CAPTCHA verification failed. Please try again."),{success:!1,error:"CAPTCHA verification failed"};S(!0),_(null);try{const i=L(e);if(Object.keys(i).length>0)throw new Error("Validation failed: "+Object.values(i).join(", "));const o=yield fetch(`${D.API_URL}/bookings/check-slot?dateTime=${encodeURIComponent(e.dateTime)}`);if(!(yield o.json()).available)throw new Error("This time slot is no longer available. Please select another time.");const l=t.find((e=>e._id===b||e.id===b)),c=a.find((e=>e.id===x)),u=(null==c?void 0:c.name)||"None",m=d.map((e=>{const t=s.find((t=>t.id.toString()===e.toString()));return{serviceId:t.id,name:t.name,price:parseFloat(t.price)}})),f=l.vehiclePricing[n],g=f+m.reduce(((e,t)=>e+t.price),0),p=new Date,v=`BK-${(p.getMonth()+1).toString().padStart(2,"0")+p.getDate().toString().padStart(2,"0")+p.getFullYear().toString()}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`,y={name:e.name.trim(),contact:e.contact.trim(),email:(null==(r=e.email)?void 0:r.trim())||null,vehicleType:n,makeModel:e.makeModel.trim(),dateTime:e.dateTime,serviceId:b,serviceName:null==l?void 0:l.name,selectedScent:u,servicePrice:f,features:l.features,optionalServices:m,totalPrice:g,confirmationNumber:v,status:"pending"},k=yield fetch(`${D.API_URL}${D.ENDPOINTS.BOOKINGS.BASE}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}),j=yield k.json();if(j.success)return w(y),h("confirmation"),{success:!0,booking:y};throw new Error(j.error||"Failed to create booking")}catch(i){return _(i.message),{success:!1,error:i.message}}finally{S(!1)}})),resetBookingState:()=>{h("service"),p(null),v(null),u([]),k({name:"",contact:"",makeModel:"",dateTime:""}),w(null),_(null),C(ct())},validateBookingData:L,canProceedToDetails:U,isFormValid:O,isCaptchaValid:f}})();A.useEffect((()=>{if("details"===e||"options"===e||"confirmation"===e){const e=document.getElementById("booking-component");if(e){const t=-80,r=e.getBoundingClientRect().top+window.pageYOffset+t;window.scrollTo({top:r,behavior:"smooth"})}}}),[e]);return u.jsxs("div",{id:"booking-component",className:"max-w-[1000px] mx-auto",children:[u.jsxs("div",{className:"text-center mb-8",children:[u.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-content-dark dark:text-white",children:"options"===e?"Enhance Your Service":"Choose Your Service Type"}),u.jsx("p",{className:"text-content-light dark:text-stone-400 mt-2",children:"options"===e?"Add optional services to customize your experience":"Select the service option that best fits your schedule"})]}),u.jsx(b,{mode:"wait",children:u.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"rounded-lg border-border-DEFAULT dark:border-stone-700 bg-background-light dark:bg-stone-800 overflow-hidden",children:h?u.jsx("div",{className:"flex justify-center items-center py-20",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-light dark:border-orange-500"})}):(()=>{switch(e){case"service":return u.jsxs(u.Fragment,{children:[u.jsx(lt,{selectedType:t,onTypeChange:p}),u.jsx(E,{selectedService:r,selectedScent:a,onServiceSelect:y,onScentSelect:k,selectedVehicleType:t})]});case"options":return u.jsx(u.Fragment,{children:u.jsx(dt,{optionalServices:g,selectedOptions:s,onOptionSelect:j,onContinue:x,onBack:v})});case"details":return u.jsx(u.Fragment,{children:u.jsx(it,{bookingDetails:n,onInputChange:w,captcha:d,onSubmit:N,isFormValid:F,onBack:v})});case"confirmation":return u.jsx(ot,{booking:i});default:return null}})()},e)}),"confirmation"===e?null:u.jsx("div",{className:"sticky bottom-0 left-0 right-0 p-4 bg-background-light/95 dark:bg-stone-900/95 backdrop-blur-sm border-t border-border-light dark:border-stone-700",children:"service"===e&&u.jsx(m.button,{onClick:x,className:"w-full p-3 rounded-lg transition-colors duration-200 "+(S?"bg-primary-light dark:bg-orange-500 text-white hover:bg-primary-DEFAULT dark:hover:bg-orange-600":"bg-background-dark dark:bg-stone-800 text-content-light dark:text-stone-500 cursor-not-allowed"),whileHover:S?{scale:1.02}:{},whileTap:S?{scale:.98}:{},disabled:!S,children:S?"Continue":"Select a package and scent to continue"})}),f&&u.jsx("div",{className:"mt-4 p-4 rounded-lg bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800",children:u.jsx("p",{className:"text-red-600 dark:text-red-400",children:f})})]})};export{ut as default};
